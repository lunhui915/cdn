/*! pjax-api v3.33.1 https://github.com/falsandtru/pjax-api | (c) 2012, falsandtru | (Apache-2.0 AND MPL-2.0) License */
require=function(){return function e(t,r,n){function i(o,c){if(!r[o]){if(!t[o]){var a="function"==typeof require&&require;if(!c&&a)return a(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){return i(t[o][1][e]||e)},l,l.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}}()({1:[function(e,t,r){},{}],2:[function(e,t,r){arguments[4][1][0].apply(r,arguments)},{dup:1}],3:[function(e,t,r){arguments[4][1][0].apply(r,arguments)},{dup:1}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isArray=r.ObjectValues=r.ObjectSetPrototypeOf=r.ObjectSeal=r.ObjectPreventExtensions=r.ObjectKeys=r.isSealed=r.isFrozen=r.isExtensible=r.ObjectIs=r.ObjectGetPrototypeOf=r.ObjectGetOwnPropertySymbols=r.ObjectGetOwnPropertyNames=r.ObjectGetOwnPropertyDescriptors=r.ObjectGetOwnPropertyDescriptor=r.ObjectFromEntries=r.ObjectFreeze=r.ObjectEntries=r.ObjectDefineProperty=r.ObjectDefineProperties=r.ObjectCreate=r.ObjectAssign=r.toString=r.isEnumerable=r.isPrototypeOf=r.hasOwnProperty=r.SymbolKeyFor=r.SymbolFor=r.parseInt=r.parseFloat=r.isSafeInteger=r.isNaN=r.isInteger=r.isFinite=r.NaN=void 0,r.NaN=Number.NaN,r.isFinite=Number.isFinite,r.isInteger=Number.isInteger,r.isNaN=Number.isNaN,r.isSafeInteger=Number.isSafeInteger,r.parseFloat=Number.parseFloat,r.parseInt=Number.parseInt,r.SymbolFor=Symbol.for,r.SymbolKeyFor=Symbol.keyFor,r.hasOwnProperty=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),r.isPrototypeOf=Object.prototype.isPrototypeOf.call.bind(Object.prototype.isPrototypeOf),r.isEnumerable=Object.prototype.propertyIsEnumerable.call.bind(Object.prototype.propertyIsEnumerable),r.toString=Object.prototype.toString.call.bind(Object.prototype.toString),r.ObjectAssign=Object.assign,r.ObjectCreate=Object.create,r.ObjectDefineProperties=Object.defineProperties,r.ObjectDefineProperty=Object.defineProperty,r.ObjectEntries=Object.entries,r.ObjectFreeze=Object.freeze,r.ObjectFromEntries=Object.fromEntries,r.ObjectGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,r.ObjectGetOwnPropertyDescriptors=Object.getOwnPropertyDescriptors,r.ObjectGetOwnPropertyNames=Object.getOwnPropertyNames,r.ObjectGetOwnPropertySymbols=Object.getOwnPropertySymbols,r.ObjectGetPrototypeOf=Object.getPrototypeOf,r.ObjectIs=Object.is,r.isExtensible=Object.isExtensible,r.isFrozen=Object.isFrozen,r.isSealed=Object.isSealed,r.ObjectKeys=Object.keys,r.ObjectPreventExtensions=Object.preventExtensions,r.ObjectSeal=Object.seal,r.ObjectSetPrototypeOf=Object.setPrototypeOf,r.ObjectValues=Object.values,r.isArray=Array.isArray},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.join=r.splice=r.push=r.pop=r.unshift=r.shift=r.indexOf=void 0;const n=e("./global");function i(e,t){if("length"in e)for(let r=e.length-1;r>=0;--r)t.unshift(e[r]);else t.unshift(...e);return t}function s(e,t){if("length"in t)for(let r=0,n=t.length;r<n;++r)e.push(t[r]);else for(const r of t)e.push(r);return e}function o(e,t,r,...c){if(0===r&&0===c.length)return[];switch(r=r>e.length?e.length:r,t){case 0:switch(r){case 0:return[[],i(c,e)][0];case 1:return 0===e.length?[[],i(c,e)][0]:[[e.shift()],i(c,e)][0];case n.undefined:if(e.length>1||arguments.length>2)break;return 0===e.length?[]:o(e,t,1)}break;case-1:case e.length-1:switch(r){case 1:return 0===e.length?[[],s(e,c)][0]:[[e.pop()],s(e,c)][0];case n.undefined:if(e.length>1||arguments.length>2)break;return 0===e.length?[]:o(e,t,1)}break;case e.length:case n.Infinity:return[[],s(e,c)][0]}return arguments.length>2?e.splice(t,r,...c):e.splice(t)}r.indexOf=function(e,t){return t==t?e.indexOf(t):e.findIndex(e=>e!=e)},r.shift=function(e,t){if(t<0)throw new Error("Unexpected negative number");return t===n.undefined?[e.shift(),e]:[o(e,0,t),e]},r.unshift=i,r.pop=function(e,t){if(t<0)throw new Error("Unexpected negative number");return t===n.undefined?[e,e.pop()]:[e,o(e,e.length-t,t)]},r.push=s,r.splice=o,r.join=function(e,t=""){let r="";for(let n=0;n<e.length;++n)r+=0===n?e[n]:t+e[n];return r}},{"./global":20}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.template=r.inherit=r.merge=r.extend=r.clone=r.assign=void 0;const n=e("./type"),i=e("./global"),s=e("./alias"),o=e("./array");function c(e){return function(t,...r){if(n.isPrimitive(t))return t;for(let i=0;i<r.length;++i){const o=r[i];if(o===t)continue;if(n.isPrimitive(o))continue;const c=s.ObjectKeys(o);for(let r=0;r<c.length;++r)e(c[r],t,o)}return t}}function a(e){switch(n.type(e)){case"Array":return[];case"Object":return e instanceof i.Object?{}:s.ObjectCreate(null);default:return e}}r.assign=c((e,t,r)=>t[e]=r[e]),r.clone=c((e,t,i)=>{switch(n.type(i[e])){case"Array":return t[e]=i[e].slice();case"Object":switch(n.type(t[e])){case"Object":return t[e]=r.clone(a(i[e]),i[e]);default:return t[e]=i[e]}default:return t[e]=i[e]}}),r.extend=c((e,t,i)=>{switch(n.type(i[e])){case"Array":return t[e]=i[e].slice();case"Object":switch(n.type(t[e])){case"Object":return t[e]=r.extend(t[e],i[e]);default:return t[e]=r.extend(a(i[e]),i[e])}default:return t[e]=i[e]}}),r.merge=c((e,t,i)=>{switch(n.type(i[e])){case"Array":switch(n.type(t[e])){case"Array":return t[e]=o.push(t[e],i[e]);default:return t[e]=i[e].slice()}case"Object":switch(n.type(t[e])){case"Object":return t[e]=r.merge(t[e],i[e]);default:return t[e]=r.merge(a(i[e]),i[e])}default:return t[e]=i[e]}}),r.inherit=c((e,t,i)=>{switch(n.type(i[e])){case"Array":return t[e]=i[e].slice();case"Object":switch(n.type(t[e])){case"Object":return t[e]=s.hasOwnProperty(t,e)?r.inherit(t[e],i[e]):r.inherit(s.ObjectCreate(t[e]),i[e]);default:return t[e]=s.ObjectCreate(i[e])}default:return t[e]=i[e]}}),r.template=c},{"./alias":4,"./array":5,"./global":20,"./type":91}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Cache=void 0;const n=e("./global"),i=e("./assign"),s=e("./array");r.Cache=class{constructor(e,t=(()=>n.undefined),r={}){if(this.capacity=e,this.callback=t,this.settings={ignore:{delete:!1,clear:!1},data:{stats:[[],[]],entries:[]}},this.nullish=!1,e>0==0)throw new Error("Spica: Cache: Cache capacity must be greater than 0.");i.extend(this.settings,r);const{stats:o,entries:c}=this.settings.data,a=o[1].slice(0,e),u=o[0].slice(0,e-a.length);if(this.stats={LRU:u,LFU:a},this.store=new n.Map(c),r.data){for(const e of s.push(o[1].slice(a.length),o[0].slice(u.length)))this.store.delete(e);if(this.store.size!==a.length+u.length)throw new Error("Spica: Cache: Size of stats and entries is not matched.");if(![...a,...u].every(e=>this.store.has(e)))throw new Error("Spica: Cache: Keys of stats and entries is not matched.")}}put(e,t){if(this.nullish||t!==n.undefined?n.undefined:this.nullish=!0,this.store.has(e)&&this.access(e))return this.store.set(e,t),!0;const{LRU:r,LFU:i}=this.stats;if(r.length+i.length===this.capacity&&r.length<i.length){const e=i.pop(),t=this.store.get(e);this.store.delete(e),this.callback(e,t)}if(r.unshift(e),this.store.set(e,t),r.length+i.length>this.capacity){const e=r.pop(),t=this.store.get(e);this.store.delete(e),this.callback(e,t)}return!1}set(e,t){return this.put(e,t),this}get(e){const t=this.store.get(e);return(t!==n.undefined||this.nullish&&this.store.has(e))&&this.access(e)?t:n.undefined}has(e){return this.store.has(e)}delete(e){if(!this.store.has(e))return!1;const{LRU:t,LFU:r}=this.stats;for(const n of[r,t]){const t=s.indexOf(n,e);if(-1===t)continue;const r=this.store.get(e);return this.store.delete(s.splice(n,t,1)[0]),!!this.settings.ignore.delete||(this.callback(e,r),!0)}return!1}clear(){const e=this.store;if(this.store=new n.Map,this.stats={LRU:[],LFU:[]},!this.settings.ignore.clear)for(const t of e)this.callback(t[0],t[1])}get size(){return this.store.size}[Symbol.iterator](){return this.store[Symbol.iterator]()}export(){return{stats:[this.stats.LRU.slice(),this.stats.LFU.slice()],entries:[...this]}}inspect(){const{LRU:e,LFU:t}=this.stats;return[e.slice(),t.slice()]}access(e){return this.accessLFU(e)||this.accessLRU(e)}accessLRU(e){const{LRU:t}=this.stats,r=s.indexOf(t,e);if(-1===r)return!1;const{LFU:n}=this.stats;return n.unshift(s.splice(t,r,1)[0]),!0}accessLFU(e){const{LFU:t}=this.stats,r=s.indexOf(t,e);return-1!==r&&(0===r||(t.unshift(s.splice(t,r,1)[0]),!0))}}},{"./array":5,"./assign":6,"./global":20}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Cancellation=void 0;const n=e("./global"),i=e("./function"),s=e("./noop"),o=e("./promise"),c=e("./exception"),a=e("./monad/maybe"),u=e("./monad/either"),l=Symbol.for("spica/cancellation::internal");r.Cancellation=class extends o.AtomicPromise{constructor(e=[]){var t;super(e=>t=e),this[l]=new h(t);for(const t of e)t.register(this.cancel)}get alive(){return this[l].alive}get canceled(){return this[l].canceled}get register(){return e=>this[l].register(e)}get cancel(){return e=>this[l].cancel(e)}get close(){return e=>this[l].close(e)}get promise(){return e=>this[l].promise(e)}get maybe(){return e=>this[l].maybe(e)}get either(){return e=>this[l].either(e)}};class h{constructor(e){this.resolve=e,this.alive=!0,this.available=!0,this.listeners=new n.Set}get canceled(){return"reason"in this}register(e){return this.alive?(this.listeners.add(t),i.once(()=>void this.listeners.delete(t))):(this.canceled&&t(this.reason),s.noop);function t(t){try{e(t)}catch(t){c.causeAsyncException(t)}}}cancel(e){if(this.available){this.available=!1,this.reason=e;for(const t of this.listeners)t(e);this.resolve(this.reason),this.alive=!1}}close(e){this.available&&(this.available=!1,this.resolve(o.AtomicPromise.reject(e)),this.alive=!1)}promise(e){return this.canceled?o.AtomicPromise.reject(this.reason):o.AtomicPromise.resolve(e)}maybe(e){return a.Just(e).bind(e=>this.canceled?a.Nothing:a.Just(e))}either(e){return u.Right(e).bind(e=>this.canceled?u.Left(this.reason):u.Right(e))}}},{"./exception":16,"./function":18,"./global":20,"./monad/either":28,"./monad/maybe":32,"./noop":82,"./promise":84}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Channel=void 0;const n=e("./promise"),i=e("./future"),s=n.AtomicPromise.resolve(),o=()=>n.AtomicPromise.reject(new Error("Spica: Channel: Closed.")),c=Symbol.for("spica/channel::internal");r.Channel=class{constructor(e=0){this[c]=new a(e)}get alive(){return this[c].alive}close(e){var t,r;if(!this.alive)return;const i=this[c],{buffer:s,producers:a,consumers:u}=i;i.alive=!1;for(let e=0;a[e]||u[e];++e)null===(t=a[e])||void 0===t||t.bind(o()),null===(r=u[e])||void 0===r||r.bind(o());u.splice(0,u.length),e?n.AtomicPromise.all([...s.splice(0,s.length),...a.splice(0,a.length)]).then(e):(s.splice(0,s.length),a.splice(0,a.length))}put(e){if(!this.alive)return o();const{size:t,buffer:r,producers:n,consumers:a}=this[c];switch(!0){case r.length<t:case a.length>0:return r.push(e),a.length>0&&a.shift().bind(r.shift()),s;default:return n[n.push(new i.AtomicFuture)-1].then(()=>this.put(e))}}take(){if(!this.alive)return o();const{buffer:e,producers:t,consumers:r}=this[c];switch(!0){case e.length>0:const s=e.shift();return t.length>0&&t.shift().bind(),n.AtomicPromise.resolve(s);case t.length>0:const o=r[r.push(new i.AtomicFuture)-1];return t.shift().bind(),o.then();default:return r[r.push(new i.AtomicFuture)-1].then()}}async*[Symbol.asyncIterator](){try{for(;this.alive;)yield this.take()}catch(e){if(this.alive)throw e}}};class a{constructor(e=0){this.size=e,this.alive=!0,this.buffer=[],this.producers=[],this.consumers=[]}}},{"./future":19,"./promise":84}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.tick=void 0;const n=e("./global"),i=e("./exception");let s=[],o=[],c=0;const a=Promise.resolve();function u(){const e=c;[c,s,o]=[0,o,s];for(let t=0;t<e;++t)try{o[t](),o[t]=n.undefined}catch(e){i.causeAsyncException(e)}o.length>1e3&&e<.5*o.length&&o.splice(n.Math.floor(.9*o.length),o.length)}r.tick=function(e){0===c&&a.then(u),c++===s.length?s.push(e):s[c-1]=e}},{"./exception":16,"./global":20}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.never=r.wait=r.clock=r.tick=void 0;const n=e("./global"),i=e("./promise");var s=e("./clock.tick");Object.defineProperty(r,"tick",{enumerable:!0,get:function(){return s.tick}}),r.clock=Promise.resolve(void 0),r.wait=function(e){return 0===e?i.AtomicPromise.resolve(r.clock):new i.AtomicPromise(t=>void n.setTimeout(t,e))},r.never=new class e extends i.AtomicPromise{static get[Symbol.species](){return e}constructor(){super(()=>void 0)}then(){return this}catch(){return this}finally(){return this}}},{"./clock.tick":10,"./global":20,"./promise":84}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Copropagator=void 0;const n=e("./global"),i=e("./alias"),s=e("./coroutine"),o=e("./promise"),c=e("./clock");r.Copropagator=class extends s.Coroutine{constructor(e,t=(e=>e[0]),r){super(async function*(){return this.then(t=>{for(const r of e)r[s.Coroutine.exit](t)},t=>{const r=o.AtomicPromise.reject(t);for(const t of e)t[s.Coroutine.exit](r)}),function e(t,r){const s=i.isArray(t)?t:[...t];return o.AtomicPromise.all(s).then(o=>{const c=i.isArray(t)?t:[...t],a=c.length===s.length&&c.every((e,t)=>c[t]===s[t]);if(!r&&a)return o;r=r||new n.Map;for(let e=0;e<o.length;++e)r.set(s[e],o[e]);return a?[...r.values()]:e(c,r)})}(e).then(e=>0===e.length?void this[s.Coroutine.terminate](new n.Error("Spica: Copropagator: No result.")):void this[s.Coroutine.exit](t(e)),e=>void this[s.Coroutine.terminate](e)),c.never},{delay:!1,...r})}}},{"./alias":4,"./clock":11,"./coroutine":13,"./global":20,"./promise":84}],13:[function(e,t,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),r.isCoroutine=r.Coroutine=void 0;const s=e("./global"),o=e("./alias"),c=e("./promise"),a=e("./future"),u=e("./channel"),l=e("./assign"),h=e("./clock"),d=e("./exception"),p=e("./noop"),f=Symbol.for("spica/Coroutine.alive"),m=Symbol.for("spica/Coroutine.init"),v=Symbol.for("spica/Coroutine.exit"),b=Symbol.for("spica/Coroutine.terminate"),y=Symbol.for("spica/Coroutine.port"),g=Symbol.for("spica/coroutine::internal");class w extends c.AtomicPromise{constructor(e,t={}){var r;super(e=>r=e),this[n]=new q(this),this[g]=new S(t);let i=0;this[w.init]=(async()=>{const t=this[g];if(!t.alive)return;if(0!==i)return;let r=p.noop;try{const n=e.call(this);for(;t.alive;){const[[e,o]]=1==++i?[[s.undefined,p.noop]]:await s.Promise.all([t.settings.size<0?[s.undefined,p.noop]:t.sendBuffer.take(),s.Promise.all([t.settings.resume(),t.settings.interval>0?h.wait(t.settings.interval):s.undefined])]);if(r=o,!t.alive)break;const c=await n.next(e);if(c.done)return t.alive=!1,r({...c}),t.recvBuffer.put({...c}),void t.result.bind(c);r({...c}),await t.recvBuffer.put({...c})}r(c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled.")))}catch(e){r(c.AtomicPromise.reject(e)),this[w.terminate](e)}});const a=this[g];if(r(a.result.then(({value:e})=>e)),a.settings.trigger!==s.undefined)for(const e of s.Array().concat(a.settings.trigger))if(!(e in this&&this.hasOwnProperty(e)))if(e in this)o.ObjectDefineProperty(this,e,{set(t){delete this[e],this[e]=t,this[m]()},get(){return delete this[e],this[m](),this[e]},enumerable:!0,configurable:!0});else{const t=o.ObjectGetOwnPropertyDescriptor(this,e)||{value:this[e],enumerable:!0,configurable:!0,writable:!0};o.ObjectDefineProperty(this,e,{set(r){o.ObjectDefineProperty(this,e,{...t,value:r}),this[m]()},get(){return this[e]},enumerable:!0,configurable:!0})}this[g].settings.run&&(this[g].settings.delay?h.tick(this[w.init]):this[w.init]())}get[f](){return this[g].alive}[v](e){this[g].alive&&c.AtomicPromise.resolve(e).then(e=>{const t=this[g];t.alive&&(t.alive=!1,t.recvBuffer.put({value:s.undefined,done:!0}),t.result.bind({value:e}))},e=>{const t=this[g];t.alive&&(t.alive=!1,t.recvBuffer.put({value:s.undefined,done:!0}),t.result.bind(c.AtomicPromise.reject(e)))})}[b](e){return this[v](c.AtomicPromise.reject(e))}async*[Symbol.asyncIterator](){const e=this[g],t=this[w.port];for(;e.alive;){const e=await t.recv();if(e.done)return e.value;yield e.value}return this}}r.Coroutine=w,n=y,w.alive=f,w.init=m,w.exit=v,w.terminate=b,w.port=y;class S{constructor(e){this.opts=e,this.settings=l.extend({run:!0,delay:!0,size:-1,interval:0,resume:()=>s.undefined,trigger:s.undefined},this.opts),this.alive=!0,this.reception=0,this.sendBuffer=this.settings.size>=0?new u.Channel(this.settings.size):s.undefined,this.recvBuffer=this.settings.size>=0?new u.Channel(0):new P,this.result=new a.AtomicFuture,this.result.finally(()=>{var e;null===(e=this.sendBuffer)||void 0===e||e.close(e=>{for(;e.length>0;){const[,t]=e.shift();try{t(c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled.")))}catch(e){d.causeAsyncException(e)}}}),this.recvBuffer.close()})}}class q{constructor(e){this[g]={co:e}}ask(e){const t=this[g].co[g];if(!t.alive)return c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."));if(t.settings.size<0)return c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Overflowed."));t.settings.size>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const r=new a.Future;return t.sendBuffer.put([e,r.bind]),++t.reception,s.Promise.all([r,t.recvBuffer.take()]).then(([e])=>e.done?t.result.then(({value:t})=>({...e,value:t})):{...e})}recv(){const e=this[g].co[g];return e.alive?(++e.reception,s.Promise.resolve(e.recvBuffer.take()).then(t=>t.done?e.result.then(({value:e})=>({...t,value:e})):{...t})):c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."))}send(e){const t=this[g].co[g];if(!t.alive)return c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."));if(t.settings.size<0)return c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Overflowed."));t.settings.size>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const r=new a.Future;return s.Promise.resolve(t.sendBuffer.put([e,r.bind]))}connect(e){const t=this[g].co[g];return t.alive?(async()=>{t.settings.size>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const r=e.call(this[g].co);let n;for(;;){const e=await r.next(n);if(e.done)return e.value;n=(await this.ask(e.value)).value}})():c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."))}}r.isCoroutine=function(e){return"object"==typeof e&&null!==e&&"function"==typeof e.constructor&&"symbol"==typeof e.constructor.alive&&"boolean"==typeof e[e.constructor.alive]&&"symbol"==typeof e.constructor.init&&"function"==typeof e[e.constructor.init]&&"symbol"==typeof e.constructor.exit&&"function"==typeof e[e.constructor.exit]&&"symbol"==typeof e.constructor.terminate&&"function"==typeof e[e.constructor.terminate]&&"symbol"==typeof e.constructor.port&&"object"==typeof e[e.constructor.port]};class P{constructor(){this[i]=new P.Internal}get alive(){return this[g].alive}close(e){var t;if(!this.alive)return;const r=this[g],{consumers:n}=r;r.alive=!1;for(let e=0;n[e];++e)null===(t=n[e])||void 0===t||t.bind(P.fail());n.splice(0,n.length),e&&e([])}put(e){if(!this.alive)return P.fail();const{consumers:t}=this[g];for(;t.length>0;)t.shift().bind(e);return P.success}take(){if(!this.alive)return P.fail();const{consumers:e}=this[g];return e[e.push(new a.AtomicFuture)-1].then()}}i=g,function(e){e.success=c.AtomicPromise.resolve(),e.fail=(()=>c.AtomicPromise.reject(new s.Error("Spica: Channel: Closed.")));e.Internal=class{constructor(){this.alive=!0,this.consumers=[]}}}(P||(P={}))},{"./alias":4,"./assign":6,"./channel":9,"./clock":11,"./exception":16,"./future":19,"./global":20,"./noop":82,"./promise":84}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uncurry=r.curry=void 0;const n=e("./global"),i=e("./array");r.curry=(e=>(function e(t,r,...i){let s;return i.length<r?(...o)=>e(s=s||i.length&&t.bind(n.undefined,...i)||t,r-i.length,...o):t(...i)})(e,e.length));r.uncurry=(e=>(function e(t){const r=t.length;return(...n)=>0===r||n.length<2||n.length<=r?t(...n):e(t(...i.shift(n,r)[0]))(...n)})(e))},{"./array":5,"./global":20}],15:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./monad/either"),r)},{"./monad/either":28}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.causeAsyncException=void 0,r.causeAsyncException=function(e){Promise.reject(e)}},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.flip=void 0,r.flip=function(e){return e.length>1?(t,r)=>e(r,t):(t,...r)=>0===r.length?r=>e(r)(t):e(r[0])(t)}},{}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.run=r.once=r.clear=r.mapReturn=r.mapParameters=void 0;const n=e("./global"),i=e("./noop");function s(e){return(...t)=>{e!==i.noop&&(e(...t),e=i.noop,t=[])}}r.mapParameters=function(e,t){return(...r)=>e(...t(...r))},r.mapReturn=function(e,t){return(...r)=>t(e(...r))},r.clear=function(e){return(...t)=>void e(...t)},r.once=s,r.run=function(e){const t=n.Array(e.length);try{for(let r=0;r<e.length;++r)t[r]=e[r]()}catch(e){for(let e=0;t[e];++e)t[e]();throw e}return s(()=>{for(let e=0;t[e];++e)t[e]()})}},{"./global":20,"./noop":82}],19:[function(e,t,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),r.AtomicFuture=r.Future=void 0;const s=e("./global"),o=e("./promise"),c=Symbol.for("spica/promise::internal");r.Future=class{constructor(e=!0){this[Symbol.toStringTag]="Promise",this[n]=new o.Internal,this.bind=(t=>{const r=this[c];if(!r.isPending&&!e)return this;if(!r.isPending)throw new Error("Spica: Future: Cannot rebind a value.");return r.resolve(t),r.resume(),this})}static get[Symbol.species](){return s.Promise}then(e,t){return new s.Promise((r,n)=>this[c].then(e,t,r,n))}catch(e){return this.then(s.undefined,e)}finally(e){return this.then(e,e).then(()=>this)}},n=c;r.AtomicFuture=class{constructor(e=!0){this[Symbol.toStringTag]="Promise",this[i]=new o.Internal,this.bind=(t=>{if(!this[c].isPending&&!e)return this;if(!this[c].isPending)throw new Error("Spica: AtomicFuture: Cannot rebind a value.");return this[c].resolve(t),this[c].resume(),this})}static get[Symbol.species](){return o.AtomicPromise}then(e,t){return new o.AtomicPromise((r,n)=>this[c].then(e,t,r,n))}catch(e){return this.then(s.undefined,e)}finally(e){return this.then(e,e).then(()=>this)}},i=c},{"./global":20,"./promise":84}],20:[function(_dereq_,module,exports){"use strict";const global="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||Function("return this")();eval("global.global = global"),module.exports=global},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.compose=void 0,r.compose=function(e,...t){return t.reduce((e,t)=>(Object.getOwnPropertyNames(t.prototype).filter(t=>!(t in e.prototype)).forEach(r=>e.prototype[r]=t.prototype[r]),Object.getOwnPropertyNames(t).filter(t=>!(t in e)).forEach(r=>e[r]=t[r]),e),e)}},{}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HList=void 0;const n=e("./array");r.HList=function(...e){return 0===e.length?i:e.reduceRight((e,t)=>e.add(t),i)};const i=new class{constructor(){this.TYPE}add(e){return new s(e,this)}unfold(e){return this.add(e())}tuple(){return[]}};class s{constructor(e,t){this.head=e,this.tail=t,this.TYPE}add(e){return new s(e,this)}modify(e){return this.tail.add(e(this.head))}fold(e){return this.tail.modify(t=>e(this.head,t))}unfold(e){return this.add(e(this.head))}reverse(){return this.tuple().reverse()}tuple(){return n.unshift([this.head],this.tail.tuple())}}},{"./array":5}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MList=r.List=void 0;const n=e("./global");function i(...e){let t=new s(n.undefined,n.undefined);for(let r=e.length-1;r>=0;--r)t=t.add(e[r]);return t}r.List=i;class s{constructor(e,t){this.head=e,this.tail=t}append(e){return this.replaceWith(e,i()).tail}add(e){return new s(e,this)}foldl(e,t){for(let r=this;r.tail;r=r.tail)t=e(t,r.head);return t}foldr(e,t){for(let r=this.reverse();r.tail;r=r.tail)t=e(r.head,t);return t}map(e){const t=i();return this.foldl((t,r)=>t.append(e(r)),t),t}replaceWith(e,t){return this.head=e,this.tail=t,this}reverse(){return this.foldl((e,t)=>e.add(t),i())}get length(){return this.foldl(e=>e+1,0)}*[Symbol.iterator](){for(let e=this;e.tail;e=e.tail)yield e.head}}function o(...e){let t=new c(n.undefined,n.undefined);for(let r=e.length-1;r>=0;--r)t=t.add(e[r]);return t}r.MList=o;class c{constructor(e,t){this.head=e,this.tail=t}take(e){if(0===e)return o();let t=this;for(let r=0;r+1<e&&t.tail;++r,t=t.tail);const r=t.tail;t.tail&&t.replaceWith(t.head,o());const n=new c(this.head,this.tail);return this.tail&&this.replaceWith(null==r?void 0:r.head,null==r?void 0:r.tail),n}prepend(e){return this.replaceWith(e,new c(this.head,this.tail))}append(e){return this.replaceWith(e,o()).tail}replace(e,t,r){const n=e.take(t),{head:i,tail:s}=e;if(null==r?void 0:r.tail)for(e.replaceWith(r.head,r.tail);e.tail;e=e.tail);return e.replaceWith(i,s),n}splice(e,t=0,r){let n=this;for(let t=0;t<e&&n.tail;++t,n=n.tail);return this.replace(n,t,r)}interleave(e,t,r){let n=this,i=0;for(;!e(n.head,n.tail?i:-1);++i,n=n.tail)if(!n.tail)return;return this.replace(n,t,r)}convert(e){for(let t=this;t.tail;t=t.tail)t.replaceWith(e(t.head),t.tail);return this}clear(){return this.replaceWith(n.undefined,n.undefined)}freeze(){const e=i();for(let t=e,r=this;r.tail;r=r.tail)t=t.append(r.head);return e}add(e){return new c(e,this)}foldl(e,t){for(let r=this;r.tail;r=r.tail)t=e(t,r.head);return t}foldr(e,t){for(let r=this.reverse();r.tail;r=r.tail)t=e(r.head,t);return t}map(e){const t=o();return this.foldl((t,r)=>t.append(e(r)),t),t}replaceWith(e,t){return this.head=e,this.tail=t,this}reverse(){if(!this.tail)return this;for(let e,t=o(),r=this;;){if(e=r.tail,r.replaceWith(r.head,t),!e.tail)return r;t=r,r=e}}get length(){return this.foldl(e=>e+1,0)}*[Symbol.iterator](){for(let e=this;e.tail;e=e.tail)yield e.head}}},{"./global":20}],24:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./monad/maybe"),r)},{"./monad/maybe":32}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.memoize=void 0;const n=e("./global");r.memoize=function e(t,r=((...e)=>e[0]),i){if("object"==typeof r)return e(t,n.undefined,r);if(i===n.undefined)return e(t,r,new n.Map);let s=!1;return(...e)=>{const o=r(...e);let c=i.get(o);return c!==n.undefined||s&&i.has(o)?c:(c=t(...e),s=s||c===n.undefined,i.set(o,c),c)}}},{"./global":20}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Applicative=void 0;const n=e("./functor"),i=e("../curry");class s extends n.Functor{}r.Applicative=s,function(e){e.ap=function e(t,r){return r?t.bind(e=>r.fmap(i.curry(e))):r=>e(t,r)}}(s=r.Applicative||(r.Applicative={}))},{"../curry":14,"./functor":29}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Right=r.Left=r.Either=void 0;const n=e("./monad"),i=e("../promise");class s extends n.Monad{constructor(e){super(e),this.EITHER}fmap(e){return this.bind(t=>new c(e(t)))}ap(e){return s.ap(this,e)}bind(e){return new s(()=>{const t=this.evaluate();if(t instanceof o)return t;if(t instanceof c)return e(t.extract());if(t instanceof s)return t.bind(e);throw new TypeError(`Spica: Either: Invalid monad value.\n\t${t}`)})}join(){return this.bind(e=>e)}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}static do(e){const t=e();let r;for(;;){const{value:e,done:n}=t.next(r);if(n)return e;const i=e.extract(()=>void 0,e=>[e]);if(!i)return e;r=i[0]}}}r.Either=s,function(e){function t(e){return new c(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t instanceof e?t.extract(e=>i.AtomicPromise.resolve(new o(e)),t=>i.AtomicPromise.resolve(t).then(e.Return)):t.reduce((e,t)=>e.bind(e=>t.fmap(t=>[...e,t])),e.Return([]))}}(s=r.Either||(r.Either={}));class o extends s{constructor(e){super(a),this.a=e,this.LEFT}bind(e){return this}extract(e){if(!e)throw this.a;return e(this.a)}}r.Left=o;class c extends s{constructor(e){super(a),this.b=e,this.RIGHT}bind(e){return new s(()=>e(this.extract()))}extract(e,t){return t?t(this.b):this.b}}function a(){throw new Error("Spica: Either: Invalid thunk call.")}r.Right=c},{"../promise":84,"./monad":33}],28:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.Right=r.Left=r.Either=void 0;const o=s(e("./either.impl"));r.Either=class extends o.Either{constructor(){super(()=>void 0)}},r.Left=function(e){return new o.Left(e)},r.Right=function(e){return new o.Right(e)}},{"./either.impl":27}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Functor=void 0;const n=e("./lazy");class i extends n.Lazy{}r.Functor=i,function(e){e.fmap=function(e,t){return t?e.fmap(t):t=>e.fmap(t)}}(i=r.Functor||(r.Functor={}))},{"./lazy":30}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Lazy=void 0;const n=e("../global");r.Lazy=class{constructor(e){this.thunk=e,this.memory_=n.undefined}evaluate(){return this.memory_?this.memory_:this.memory_=this.thunk()}}},{"../global":20}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Nothing=r.Just=r.Maybe=void 0;const n=e("./monadplus"),i=e("../promise");class s extends n.MonadPlus{constructor(e){super(e),this.MAYBE}fmap(e){return this.bind(t=>new o(e(t)))}ap(e){return s.ap(this,e)}bind(e){return new s(()=>{const t=this.evaluate();if(t instanceof o)return e(t.extract());if(t instanceof c)return t;if(t instanceof s)return t.bind(e);throw new TypeError(`Spica: Maybe: Invalid monad value.\n\t${t}`)})}guard(e){return e?this:s.mzero}join(){return this.bind(e=>e)}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}static do(e){const t=e();let r;for(;;){const{value:e,done:n}=t.next(r);if(n)return e;const i=e.extract(()=>void 0,e=>[e]);if(!i)return e;r=i[0]}}}r.Maybe=s,function(e){function t(e){return new o(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t instanceof e?t.extract(()=>i.AtomicPromise.resolve(e.mzero),t=>i.AtomicPromise.resolve(t).then(e.Return)):t.reduce((e,t)=>e.bind(e=>t.fmap(t=>[...e,t])),e.Return([]))}}(s=r.Maybe||(r.Maybe={}));class o extends s{constructor(e){super(a),this.a=e,this.JUST}bind(e){return new s(()=>e(this.extract()))}extract(e,t){return t?t(this.a):this.a}}r.Just=o;class c extends s{constructor(){super(a),this.NOTHING}bind(e){return this}extract(e){if(!e)throw void 0;return e()}}function a(){throw new Error("Spica: Maybe: Invalid thunk call.")}r.Nothing=c,function(e){e.mzero=new c,e.mplus=function(t,r){return new e(()=>t.fmap(()=>t).extract(()=>r))}}(s=r.Maybe||(r.Maybe={}))},{"../promise":84,"./monadplus":34}],32:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.Nothing=r.Just=r.Maybe=void 0;const o=s(e("./maybe.impl"));r.Maybe=class extends o.Maybe{constructor(){super(()=>void 0)}},r.Just=function(e){return new o.Just(e)},r.Nothing=o.Maybe.mzero},{"./maybe.impl":31}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Monad=void 0;const n=e("./applicative");class i extends n.Applicative{}r.Monad=i,function(e){e.bind=function e(t,r){return r?t.bind(r):r=>e(t,r)}}(i=r.Monad||(r.Monad={}))},{"./applicative":26}],34:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.MonadPlus=void 0;const n=e("./monad");class i extends n.Monad{}r.MonadPlus=i,i=r.MonadPlus||(r.MonadPlus={})},{"./monad":33}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Sequence=void 0,e("./sequence/member/static/resume"),e("./sequence/member/static/from"),e("./sequence/member/static/cycle"),e("./sequence/member/static/random"),e("./sequence/member/static/concat"),e("./sequence/member/static/zip"),e("./sequence/member/static/difference"),e("./sequence/member/static/union"),e("./sequence/member/static/intersect"),e("./sequence/member/static/pure"),e("./sequence/member/static/return"),e("./sequence/member/static/sequence"),e("./sequence/member/static/mempty"),e("./sequence/member/static/mconcat"),e("./sequence/member/static/mappend"),e("./sequence/member/static/mzero"),e("./sequence/member/static/mplus"),e("./sequence/member/instance/extract"),e("./sequence/member/instance/iterate"),e("./sequence/member/instance/memoize"),e("./sequence/member/instance/reduce"),e("./sequence/member/instance/take"),e("./sequence/member/instance/drop"),e("./sequence/member/instance/takeWhile"),e("./sequence/member/instance/dropWhile"),e("./sequence/member/instance/takeUntil"),e("./sequence/member/instance/dropUntil"),e("./sequence/member/instance/sort"),e("./sequence/member/instance/unique"),e("./sequence/member/instance/fmap"),e("./sequence/member/instance/ap"),e("./sequence/member/instance/bind"),e("./sequence/member/instance/join"),e("./sequence/member/instance/mapM"),e("./sequence/member/instance/filterM"),e("./sequence/member/instance/map"),e("./sequence/member/instance/filter"),e("./sequence/member/instance/scanl"),e("./sequence/member/instance/foldr"),e("./sequence/member/instance/group"),e("./sequence/member/instance/inits"),e("./sequence/member/instance/tails"),e("./sequence/member/instance/segs"),e("./sequence/member/instance/subsequences"),e("./sequence/member/instance/permutations");var n=e("./sequence/core");Object.defineProperty(r,"Sequence",{enumerable:!0,get:function(){return n.Sequence}})},{"./sequence/core":36,"./sequence/member/instance/ap":37,"./sequence/member/instance/bind":38,"./sequence/member/instance/drop":39,"./sequence/member/instance/dropUntil":40,"./sequence/member/instance/dropWhile":41,"./sequence/member/instance/extract":42,"./sequence/member/instance/filter":43,"./sequence/member/instance/filterM":44,"./sequence/member/instance/fmap":45,"./sequence/member/instance/foldr":46,"./sequence/member/instance/group":47,"./sequence/member/instance/inits":48,"./sequence/member/instance/iterate":49,"./sequence/member/instance/join":50,"./sequence/member/instance/map":51,"./sequence/member/instance/mapM":52,"./sequence/member/instance/memoize":53,"./sequence/member/instance/permutations":54,"./sequence/member/instance/reduce":55,"./sequence/member/instance/scanl":56,"./sequence/member/instance/segs":57,"./sequence/member/instance/sort":58,"./sequence/member/instance/subsequences":59,"./sequence/member/instance/tails":60,"./sequence/member/instance/take":61,"./sequence/member/instance/takeUntil":62,"./sequence/member/instance/takeWhile":63,"./sequence/member/instance/unique":64,"./sequence/member/static/concat":65,"./sequence/member/static/cycle":66,"./sequence/member/static/difference":67,"./sequence/member/static/from":68,"./sequence/member/static/intersect":69,"./sequence/member/static/mappend":70,"./sequence/member/static/mconcat":71,"./sequence/member/static/mempty":72,"./sequence/member/static/mplus":73,"./sequence/member/static/mzero":74,"./sequence/member/static/pure":75,"./sequence/member/static/random":76,"./sequence/member/static/resume":77,"./sequence/member/static/return":78,"./sequence/member/static/sequence":79,"./sequence/member/static/union":80,"./sequence/member/static/zip":81}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Sequence=void 0;const n=e("../monadplus");class i extends n.MonadPlus{constructor(e){super(s),this.cons=e}[Symbol.iterator](){let e=()=>this.iterate();return{next(){const t=e();return e=i.Thunk.iterator(t),{done:!i.isIterable(t),value:i.Thunk.value(t)}}}}}function s(){throw new Error("Spica: Sequence: Invalid thunk call.")}r.Sequence=i,i=r.Sequence||(r.Sequence={}),function(e){let t,r,n,i;!function(t){t.cons=function(t,r){switch(arguments.length){case 0:return[];case 1:return[t];case 2:return[t,r];default:throw e.Exception.invalidConsError(arguments)}}}(t=e.Data||(e.Data={})),function(e){e.value=function(e){return e[0]},e.iterator=function(e){return e[1]},e.index=function(e){return e[2]}}(r=e.Thunk||(e.Thunk={})),function(t){t.done=(()=>[void 0,t.done,-1]),t.when=function t(n,i,s){return e.isIterable(n)?s(n,()=>t(r.iterator(n)(),i,s)):i(n)}}(n=e.Iterator||(e.Iterator={})),e.isIterable=function(e){return r.iterator(e)!==n.done},function(e){e.invalidConsError=function(e){return console.error(e,e.length,e[0],e[1]),new TypeError("Spica: Sequence: Invalid parameters of cons.")},e.invalidDataError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid data.")},e.invalidThunkError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid thunk.")}}(i=e.Exception||(e.Exception={}))}(i=r.Sequence||(r.Sequence={}))},{"../monadplus":34}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{ap(e){return n.Sequence.ap(this,e)}})},{"../../../../helper/compose":21,"../../core":36}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{bind(e){return n.Sequence.concat(this.fmap(e))}})},{"../../../../helper/compose":21,"../../core":36}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{drop(e){return new n.Sequence((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),()=>r(),(t,i)=>n.Sequence.Thunk.index(t)<e?i():r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":21,"../../core":36}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{dropUntil(e){return new n.Sequence((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),()=>r(),(t,i)=>e(n.Sequence.Thunk.value(t))?i():r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":21,"../../core":36}],41:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{dropWhile(e){return new n.Sequence((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),()=>r(),(t,i)=>e(n.Sequence.Thunk.value(t))?i():r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":21,"../../core":36}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{extract(){const e=[];let t=()=>this.iterate();for(;;){const r=t();if(!n.Sequence.isIterable(r))return e;e.push(n.Sequence.Thunk.value(r)),t=n.Sequence.Thunk.iterator(r)}}})},{"../../../../helper/compose":21,"../../core":36}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{filter(e){return new n.Sequence((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),()=>r(),(t,i)=>e(n.Sequence.Thunk.value(t),n.Sequence.Thunk.index(t))?r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t)):i()))}})},{"../../../../helper/compose":21,"../../core":36}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{filterM(e){return n.Sequence.from([0]).bind(()=>{const t=this.extract();switch(t.length){case 0:return n.Sequence.from([[]]);default:{const r=t.shift();return e(r).bind(i=>i?0===t.length?n.Sequence.from([[r]]):n.Sequence.from(t).filterM(e).fmap(e=>[r,...e]):0===t.length?n.Sequence.from([[]]):n.Sequence.from(t).filterM(e))}}})}})},{"../../../../helper/compose":21,"../../core":36}],45:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{fmap(e){return new n.Sequence((t=(()=>this.iterate()))=>n.Sequence.Iterator.when(t(),()=>n.Sequence.Data.cons(),t=>n.Sequence.Data.cons(e(n.Sequence.Thunk.value(t)),n.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":21,"../../core":36}],46:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{foldr(e,t){return new n.Sequence((r=(()=>this.reduce().iterate()))=>n.Sequence.Iterator.when(r(),()=>n.Sequence.Data.cons(t),r=>n.Sequence.Data.cons(e(n.Sequence.Thunk.value(r),n.Sequence.resume(n.Sequence.Thunk.iterator(r)).foldr(e,t))))).bind(e=>e)}})},{"../../../../helper/compose":21,"../../core":36}],47:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{group(e){return new n.Sequence(([t,r]=[()=>this.iterate(),[]],i)=>n.Sequence.Iterator.when(t(),()=>0===r.length?i():i(r),(t,s)=>0===r.length||e(r[0],n.Sequence.Thunk.value(t))?(r.push(n.Sequence.Thunk.value(t)),s()):i(r,[n.Sequence.Thunk.iterator(t),[n.Sequence.Thunk.value(t)]])))}})},{"../../../../helper/compose":21,"../../core":36}],48:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{inits(){return n.Sequence.mappend(n.Sequence.from([[]]),this.scanl((e,t)=>[...e,t],[]).dropWhile(e=>0===e.length))}})},{"../../../../helper/compose":21,"../../core":36}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{iterate(){return this.iterate_()}iterate_(e,t=0){const r=this.cons(e,n.Sequence.Data.cons);switch(r.length){case 0:return[void 0,n.Sequence.Iterator.done,-1];case 1:return[r[0],()=>n.Sequence.Iterator.done(),t];case 2:return[r[0],()=>this.iterate_(r[1],t+1),t];default:throw n.Sequence.Exception.invalidDataError(r)}}})},{"../../../../helper/compose":21,"../../core":36}],50:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{join(){return n.Sequence.concat(this)}})},{"../../../../helper/compose":21,"../../core":36}],51:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{map(e){return new n.Sequence((t=(()=>this.iterate()))=>n.Sequence.Iterator.when(t(),()=>n.Sequence.Data.cons(),t=>n.Sequence.Data.cons(e(n.Sequence.Thunk.value(t),n.Sequence.Thunk.index(t)),n.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":21,"../../core":36}],52:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{mapM(e){return n.Sequence.from([0]).bind(()=>{const t=this.extract();switch(t.length){case 0:return n.Sequence.mempty;default:{const r=t.shift();return e(r).bind(r=>0===t.length?n.Sequence.from([[r]]):n.Sequence.from(t).mapM(e).fmap(e=>[r,...e]))}}})}})},{"../../../../helper/compose":21,"../../core":36}],53:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../../../global"),i=e("../../core"),s=e("../../../../helper/compose"),o=e("../../../../memoize").memoize(e=>new n.Map);s.compose(i.Sequence,class extends i.Sequence{memoize(){return new i.Sequence(([e,t]=[0,o(this)],r)=>i.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?i.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),()=>r(),n=>r(i.Sequence.Thunk.value(n),[e+1,t])))}})},{"../../../../global":20,"../../../../helper/compose":21,"../../../../memoize":25,"../../core":36}],54:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{permutations(){return n.Sequence.from([0]).bind(()=>{const e=this.extract();return 0===e.length?n.Sequence.mempty:n.Sequence.from([e])}).bind(e=>n.Sequence.mappend(n.Sequence.from([e]),function e(t,r){return n.Sequence.Iterator.when(t.iterate(),()=>n.Sequence.mempty,t=>new n.Sequence((i,s)=>n.Sequence.Iterator.when(t,()=>s(),t=>{const i=n.Sequence.Thunk.value(t),o=n.Sequence.resume(n.Sequence.Thunk.iterator(t)).memoize();return s(r.permutations().foldr((e,t)=>(function(e,t){return function e(t,r,s){return n.Sequence.Iterator.when(r.iterate(),()=>[o,s],r=>{const o=n.Sequence.Thunk.value(r),[c,a]=e(e=>t(n.Sequence.mappend(n.Sequence.from([o]),e)),n.Sequence.resume(n.Sequence.Thunk.iterator(r)),s);return[n.Sequence.mappend(n.Sequence.from([o]),c),n.Sequence.mappend(n.Sequence.from([t(n.Sequence.mappend(n.Sequence.from([i]),n.Sequence.mappend(n.Sequence.from([o]),c))).extract()]),a)]})}(e=>e,e,t)[1]})(n.Sequence.from(e),t),e(o,n.Sequence.mappend(n.Sequence.from([i]),r))))})).bind(e=>e))}(n.Sequence.from(e),n.Sequence.mempty)))}})},{"../../../../helper/compose":21,"../../core":36}],55:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../../../global"),i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,class extends i.Sequence{reduce(){return new i.Sequence(([e,t]=[0,new n.Map],r)=>i.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?i.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),()=>r(),n=>r(i.Sequence.Thunk.value(n),[e+1,t])))}})},{"../../../../global":20,"../../../../helper/compose":21,"../../core":36}],56:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{scanl(e,t){return new n.Sequence(([r,i,s]=[t,()=>this.iterate(),0])=>n.Sequence.Iterator.when(i(),()=>0===s?n.Sequence.Data.cons(t):n.Sequence.Data.cons(),t=>n.Sequence.Data.cons(r=e(r,n.Sequence.Thunk.value(t)),[r,n.Sequence.Thunk.iterator(t),n.Sequence.Thunk.index(t)+1])))}})},{"../../../../helper/compose":21,"../../core":36}],57:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{segs(){return n.Sequence.mappend(this.foldr((e,t)=>t.take(1).bind(r=>n.Sequence.mappend(n.Sequence.from([n.Sequence.mappend(n.Sequence.from([[e]]),n.Sequence.from(r).map(t=>[e,...t]))]),t)),n.Sequence.from([n.Sequence.from([])])).bind(e=>e),n.Sequence.from([[]]))}})},{"../../../../helper/compose":21,"../../core":36}],58:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{sort(e){return n.Sequence.from(this.extract().sort(e))}})},{"../../../../helper/compose":21,"../../core":36}],59:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{subsequences(){return n.Sequence.mappend(n.Sequence.from([[]]),n.Sequence.from([0]).bind(()=>(function e(t){return n.Sequence.Iterator.when(t.iterate(),()=>n.Sequence.mempty,t=>n.Sequence.mappend(n.Sequence.from([[n.Sequence.Thunk.value(t)]]),new n.Sequence((r,i)=>n.Sequence.Iterator.when(t,()=>i(),t=>i(e(n.Sequence.resume(n.Sequence.Thunk.iterator(t))).foldr((e,r)=>n.Sequence.mappend(n.Sequence.mappend(n.Sequence.from([e]),n.Sequence.from([[n.Sequence.Thunk.value(t),...e]])),r),n.Sequence.mempty)))).bind(e=>e)))})(this)))}})},{"../../../../helper/compose":21,"../../core":36}],60:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{tails(){return n.Sequence.mappend(n.Sequence.from(this.extract().map((e,t,r)=>r.slice(t))),n.Sequence.from([[]]))}})},{"../../../../helper/compose":21,"../../core":36}],61:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{take(e){return new n.Sequence((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(e>0?t():n.Sequence.Iterator.done(),()=>r(),t=>n.Sequence.Thunk.index(t)+1<e?r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t)):r(n.Sequence.Thunk.value(t))))}})},{"../../../../helper/compose":21,"../../core":36}],62:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{takeUntil(e){return new n.Sequence((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),()=>r(),t=>e(n.Sequence.Thunk.value(t))?r(n.Sequence.Thunk.value(t)):r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":21,"../../core":36}],63:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{takeWhile(e){return new n.Sequence((t=(()=>this.iterate()),r)=>n.Sequence.Iterator.when(t(),()=>r(),t=>e(n.Sequence.Thunk.value(t))?r(n.Sequence.Thunk.value(t),n.Sequence.Thunk.iterator(t)):r()))}})},{"../../../../helper/compose":21,"../../core":36}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{unique(){const e=new Set;return this.filter(t=>!e.has(t)&&!!e.add(t))}})},{"../../../../helper/compose":21,"../../core":36}],65:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static concat(e){return new n.Sequence(([t,r]=[()=>e.iterate(),n.Sequence.Iterator.done],i)=>n.Sequence.Iterator.when(t(),()=>i(),(e,t)=>(r=r===n.Sequence.Iterator.done?()=>n.Sequence.Thunk.value(e).iterate():r,n.Sequence.Iterator.when(r(),()=>(r=n.Sequence.Iterator.done,t()),t=>i(n.Sequence.Thunk.value(t),[()=>e,n.Sequence.Thunk.iterator(t)])))))}})},{"../../../../helper/compose":21,"../../core":36}],66:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static cycle(e){return new n.Sequence(function t([r,n]=[e[Symbol.iterator](),0],i){const s=r.next();return s.done?t([e[Symbol.iterator](),n+1],i):i(s.value,[r,n+1])}).reduce()}})},{"../../../../helper/compose":21,"../../core":36}],67:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static difference(e,t,r){return new n.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>n.Sequence.Iterator.when(i(),()=>n.Sequence.Iterator.when(s(),()=>o(),e=>o(n.Sequence.Thunk.value(e),[n.Sequence.Iterator.done,n.Sequence.Thunk.iterator(e)])),(e,t)=>n.Sequence.Iterator.when(s(),()=>o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),n.Sequence.Iterator.done]),i=>{const c=r(n.Sequence.Thunk.value(e),n.Sequence.Thunk.value(i));return c<0?o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),()=>i]):c>0?o(n.Sequence.Thunk.value(i),[()=>e,n.Sequence.Thunk.iterator(i)]):(s=(()=>n.Sequence.Thunk.iterator(i)()),t())})))}})},{"../../../../helper/compose":21,"../../core":36}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static from(e){return new n.Sequence(([t,r]=[e[Symbol.iterator](),0],n)=>{const i=t.next();return i.done?n():n(i.value,[t,r+1])}).reduce()}})},{"../../../../helper/compose":21,"../../core":36}],69:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static intersect(e,t,r){return new n.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>n.Sequence.Iterator.when(i(),()=>o(),(e,t)=>n.Sequence.Iterator.when(s(),()=>o(),(i,c)=>{const a=r(n.Sequence.Thunk.value(e),n.Sequence.Thunk.value(i));return a<0?(s=(()=>i),t()):a>0?c():o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),n.Sequence.Thunk.iterator(i)])})))}})},{"../../../../helper/compose":21,"../../core":36}],70:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static mappend(e,t){return n.Sequence.mconcat([e,t])}})},{"../../../../helper/compose":21,"../../core":36}],71:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static mconcat(e){return[...e].reduce((e,t)=>(function(e,t){return new n.Sequence(([r,i]=[()=>e.iterate(),()=>t.iterate()],s)=>n.Sequence.Iterator.when(r(),()=>n.Sequence.Iterator.when(i(),()=>s(),e=>s(n.Sequence.Thunk.value(e),[n.Sequence.Iterator.done,n.Sequence.Thunk.iterator(e)])),e=>s(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),i])))})(e,t),n.Sequence.mempty)}})},{"../../../../helper/compose":21,"../../core":36}],72:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0});const i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,((n=class extends i.Sequence{}).mempty=new i.Sequence((e,t)=>t()),n))},{"../../../../helper/compose":21,"../../core":36}],73:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0});const i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,((n=class extends i.Sequence{}).mplus=i.Sequence.mappend,n))},{"../../../../helper/compose":21,"../../core":36}],74:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0});const i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,((n=class extends i.Sequence{}).mzero=i.Sequence.mempty,n))},{"../../../../helper/compose":21,"../../core":36}],75:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static pure(e){return new n.Sequence((t,r)=>r(e))}})},{"../../../../helper/compose":21,"../../core":36}],76:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../../../global"),i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,class extends i.Sequence{static random(e=(()=>n.Math.random())){return"function"==typeof e?i.Sequence.from(new i.Sequence((t,r)=>r(e(),t))):this.random().map(t=>e[n.Math.floor(t*e.length)])}})},{"../../../../global":20,"../../../../helper/compose":21,"../../core":36}],77:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static resume(e){return new n.Sequence((t=e,r)=>n.Sequence.Iterator.when(t(),()=>r(),e=>r(n.Sequence.Thunk.value(e),n.Sequence.Thunk.iterator(e))))}})},{"../../../../helper/compose":21,"../../core":36}],78:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static Return(e){return new n.Sequence((t,r)=>r(e))}})},{"../../../../helper/compose":21,"../../core":36}],79:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static sequence(e){return e.reduce((e,t)=>e.fmap(e=>n.Sequence.mappend(e,t)),n.Sequence.Return(n.Sequence.from([])))}})},{"../../../../helper/compose":21,"../../core":36}],80:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static union(e,t,r){return new n.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>n.Sequence.Iterator.when(i(),()=>n.Sequence.Iterator.when(s(),()=>o(),e=>o(n.Sequence.Thunk.value(e),[n.Sequence.Iterator.done,n.Sequence.Thunk.iterator(e)])),e=>n.Sequence.Iterator.when(s(),()=>o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),n.Sequence.Iterator.done]),t=>{const i=r(n.Sequence.Thunk.value(e),n.Sequence.Thunk.value(t));return i<0?o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),()=>t]):i>0?o(n.Sequence.Thunk.value(t),[()=>e,n.Sequence.Thunk.iterator(t)]):o(n.Sequence.Thunk.value(e),[n.Sequence.Thunk.iterator(e),n.Sequence.Thunk.iterator(t)])})))}})},{"../../../../helper/compose":21,"../../core":36}],81:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../../core");e("../../../../helper/compose").compose(n.Sequence,class extends n.Sequence{static zip(e,t){return new n.Sequence(([r,i]=[()=>e.iterate(),()=>t.iterate()],s)=>n.Sequence.Iterator.when(r(),()=>s(),e=>n.Sequence.Iterator.when(i(),()=>s(),t=>s([n.Sequence.Thunk.value(e),n.Sequence.Thunk.value(t)],[n.Sequence.Thunk.iterator(e),n.Sequence.Thunk.iterator(t)]))))}})},{"../../../../helper/compose":21,"../../core":36}],82:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.noop=void 0,r.noop=function(){}},{}],83:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Observation=void 0;const n=e("./global"),i=e("./assign"),s=e("./array"),o=e("./exception");class c{constructor(e,t){this.parent=e,this.index=t,this.children=new n.Map,this.childrenIndexes=[],this.monitors=[],this.subscribers=[]}}r.Observation=class{constructor(e={}){this.id=0,this.node=new c(n.undefined,n.undefined),this.settings={limit:10,cleanup:!1},this.unrelaies=new n.WeakMap,i.extend(this.settings,e)}monitor(e,t,{once:r=!1}={}){if("function"!=typeof t)throw new n.Error(`Spica: Observation: Invalid listener: ${t}`);const{monitors:i}=this.seekNode(e,0);if(i.length===this.settings.limit)throw new n.Error("Spica: Observation: Exceeded max listener limit.");if(this.id===n.Number.MAX_SAFE_INTEGER)throw new n.Error("Spica: Observation: Max listener ID reached max safe integer.");const s={id:++this.id,type:0,namespace:e,listener:t,options:{once:r}};return i.push(s),()=>void this.off(e,s)}on(e,t,{once:r=!1}={}){if("function"!=typeof t)throw new n.Error(`Spica: Observation: Invalid listener: ${t}`);const{subscribers:i}=this.seekNode(e,0);if(i.length===this.settings.limit)throw new n.Error("Spica: Observation: Exceeded max listener limit.");if(this.id===n.Number.MAX_SAFE_INTEGER)throw new n.Error("Spica: Observation: Max listener ID reached max safe integer.");const s={id:++this.id,type:1,namespace:e,listener:t,options:{once:r}};return i.push(s),()=>void this.off(e,s)}once(e,t){return this.on(e,t,{once:!0})}off(e,t){const r=this.seekNode(e,1);if(r)switch(typeof t){case"object":{const e=0===t.type?r.monitors:r.subscribers;if(0===e.length||t.id<e[0].id||t.id>e[e.length-1].id)return;return void s.splice(e,e.indexOf(t),1)}case"function":{const e=r.subscribers;return void s.splice(e,e.findIndex(e=>e.listener===t),1)}case"undefined":return void function e({monitors:t,subscribers:r,childrenIndexes:n,children:i}){for(let t=0;t<n.length;++t)e(i.get(n[t]))&&(i.delete(n[t]),s.splice(n,t,1),--t);return s.splice(r,0),0===t.length}(r)}}emit(e,t,r){this.drain(e,t,r)}reflect(e,t){let r;return this.emit(e,t,(e,t)=>r=t),r}relay(e){if(this.unrelaies.has(e))return this.unrelaies.get(e);const t=e.monitor([],(e,t)=>void this.emit(t,e)),r=()=>(this.unrelaies.delete(e),void t());return this.unrelaies.set(e,r),r}refs(e){const t=this.seekNode(e,1);return t?s.push(this.refsBelow(t,0),this.refsBelow(t,1)).reduce((e,t)=>s.push(e,t),[]):[]}drain(e,t,r){const n=this.seekNode(e,1),i=[],s=n?this.refsBelow(n,1):[];for(let n=0;n<s.length;++n){const c=s[n];if(0!==c.length)for(let n=0,s=c[c.length-1].id;n<c.length&&c[n].id<=s;++n){const s=c[n];s.options.once&&this.off(s.namespace,s);try{const n=s.listener(t,e);r&&i.push(n)}catch(e){o.causeAsyncException(e)}for(n=n<c.length?n:c.length-1;n>=0&&c[n].id>s.id;--n);}}const c=this.refsAbove(n||this.seekNode(e,2),0);for(let r=0;r<c.length;++r){const n=c[r];if(0!==n.length)for(let r=0,i=n[n.length-1].id;r<n.length&&n[r].id<=i;++r){const i=n[r];i.options.once&&this.off(i.namespace,i);try{i.listener(t,e)}catch(e){o.causeAsyncException(e)}for(r=r<n.length?r:n.length-1;r>=0&&n[r].id>i.id;--r);}}if(r)try{r(t,i)}catch(e){o.causeAsyncException(e)}}refsAbove({parent:e,monitors:t,subscribers:r},n){const i=0===n?[t]:[r];for(;e;)0===n?i.push(e.monitors):i.push(e.subscribers),e=e.parent;return i}refsBelow(e,t){return this.refsBelow_(e,t,[])[0]}refsBelow_({monitors:e,subscribers:t,childrenIndexes:r,children:n},i,o){0===i?o.push(e):o.push(t);let c=0;for(let e=0;e<r.length;++e){const t=r[e],a=this.refsBelow_(n.get(t),i,o)[1];c+=a,0===a&&this.settings.cleanup&&(n.delete(t),s.splice(r,e,1),--e)}return[o,e.length+t.length+c]}seekNode(e,t){let r=this.node;for(let n=0;n<e.length;++n){const i=e[n],{childrenIndexes:s,children:o}=r;let a=o.get(i);if(!a){switch(t){case 1:return;case 2:return r}a=new c(r,i),s.push(i),o.set(i,a)}r=a}return r}}},{"./array":5,"./assign":6,"./exception":16,"./global":20}],84:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.isPromiseLike=r.Internal=r.AtomicPromise=void 0;const i=e("./global"),s=e("./alias"),o=e("./array"),c=Symbol.for("spica/promise::internal");class a{constructor(e){this[Symbol.toStringTag]="Promise",this[n]=new u;try{e(e=>this[c].resolve(e),e=>this[c].reject(e))}catch(e){this[c].reject(e)}}static get[Symbol.species](){return a}static all(e){return new a((t,r)=>{const n=s.isArray(e)?e:[...e],o=i.Array(n.length);let a=0;for(let e=0;e<n.length;++e){const i=n[e];if(l(i)){if(h(i)){const{status:t}=i[c];switch(t.state){case 2:o[e]=t.value,++a;continue;case 3:r(t.reason),e=n.length;continue}}i.then(r=>{o[e]=r,++a===n.length&&t(o)},t=>{r(t),e=n.length})}else o[e]=i,++a}a===n.length&&t(o)})}static race(e){return new a((t,r)=>{const n=s.isArray(e)?e:[...e];for(let e=0;e<n.length;++e){const i=n[e];if(!l(i))return t(i);if(h(i)){const{status:e}=i[c];switch(e.state){case 2:return t(e.value);case 3:return r(e.reason)}}}let i=!1;for(let e=0;e<n.length;++e){if(n[e].then(e=>{t(e),i=!0},e=>{r(e),i=!0}),i)return}})}static allSettled(e){return new a(t=>{const r=s.isArray(e)?e:[...e],n=i.Array(r.length);let o=0;for(let e=0;e<r.length;++e){const i=r[e];if(l(i)){if(h(i)){const{status:t}=i[c];switch(t.state){case 2:n[e]={status:"fulfilled",value:t.value},++o;continue;case 3:n[e]={status:"rejected",reason:t.reason},++o;continue}}i.then(i=>{n[e]={status:"fulfilled",value:i},++o===r.length&&t(n)},i=>{n[e]={status:"rejected",reason:i},++o===r.length&&t(n)})}else n[e]={status:"fulfilled",value:i},++o}o===r.length&&t(n)})}static resolve(e){return new a(t=>t(e))}static reject(e){return new a((t,r)=>r(e))}then(e,t){return new a((r,n)=>this[c].then(e,t,r,n))}catch(e){return this.then(i.undefined,e)}finally(e){return this.then(e,e).then(()=>this)}}r.AtomicPromise=a,n=c;class u{constructor(){this.status={state:0},this.reactable=!0,this.fulfillReactions=[],this.rejectReactions=[],this.isHandled=!1}get isPending(){return 0===this.status.state}resolve(e){if(0===this.status.state){if(!l(e))return this.status={state:2,value:e},this.resume();this.status={state:1,promise:e},e.then(e=>{this.status={state:2,value:e},this.resume()},e=>{this.status={state:3,reason:e},this.resume()})}}reject(e){if(0===this.status.state)return this.status={state:3,reason:e},this.resume()}then(e,t,r,n){const{status:i,fulfillReactions:s,rejectReactions:o}=this;switch(i.state){case 2:if(s.length>0)break;try{return r(e?e(i.value):i.value)}catch(e){return n(e)}case 3:if(o.length>0)break;try{return t?r(t(i.reason)):n(i.reason)}catch(e){return n(e)}default:return s.push(t=>{try{r(e?e(t):t)}catch(e){n(e)}}),o.push(e=>{try{t?r(t(e)):n(e)}catch(e){n(e)}}),this.resume()}}resume(){if(!this.reactable)return;const{status:e,fulfillReactions:t,rejectReactions:r}=this;switch(e.state){case 0:case 1:return;case 2:if(this.isHandled&&r.length>0&&o.splice(r,0),0===t.length)return;return this.isHandled=!0,void this.react(t,e.value);case 3:if(this.isHandled&&t.length>0&&o.splice(t,0),0===r.length)return;return this.isHandled=!0,void this.react(r,e.reason)}}react(e,t){if(this.reactable=!1,e.length<5)for(;e.length>0;)e.shift()(t);else{for(let r=0;r<e.length;++r)e[r](t);o.splice(e,0)}this.reactable=!0}}function l(e){return null!==e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}function h(e){return c in e}r.Internal=u,r.isPromiseLike=l},{"./alias":4,"./array":5,"./global":20}],85:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.unique=r.rnd0Z=r.rnd0z=r.rnd0f=r.rnd64=r.rnd62=r.rnd36=r.rnd32=r.rnd16=void 0;const n=e("./global"),i=[...Array(7)].map((e,t)=>1<<t),s=[...[...Array(36)].map((e,t)=>t.toString(36)),...[...Array(26)].map((e,t)=>(t+10).toString(36).toUpperCase())];function o(e){var t;const r=null!==(t=i.find(t=>t>=e))&&void 0!==t?t:i[i.length-1],n=i.indexOf(r);return()=>{for(;;){const t=p(n);if(t<e)return t}}}function c(e){return(t=1)=>{let r="";for(;t--;)r+=s[e()];return r}}r.rnd16=o(16),r.rnd32=o(32),r.rnd36=o(36),r.rnd62=o(62),r.rnd64=o(64),r.rnd0f=c(r.rnd16),r.rnd0z=c(r.rnd36),r.rnd0Z=c(r.rnd62),r.unique=function(e,t,r=new n.Set){let i=5;return()=>{for(;;){for(let n=0;n<i;++n){const n=e(t);if(!r.has(n))return r.add(n),n}i=++t<3?i:3}}};const a=new Uint16Array(512),u=16,l=i.map((e,t)=>+`0b${"1".repeat(t)||0}`);let h=a.length,d=u;function p(e){return h===a.length&&(n.crypto.getRandomValues(a),h=0),d<e?(d=u,++h,p(e)):d>e?(d-=e,a[h]>>d&l[e]):(d=u,a[h++]&l[e])}},{"./global":20}],86:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./monad/sequence"),r)},{"./monad/sequence":35}],87:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.sqid=void 0;const n=e("./global"),i="0".repeat(15);let s=0;r.sqid=function e(t){if(0===arguments.length){if(s===n.Number.MAX_SAFE_INTEGER)throw new TypeError("Spica: sqid: sqid reached max safe integer.");return e(++s)}if("number"!=typeof t)throw new TypeError(`Spica: sqid: A parameter value must be a number: ${t}`);if(t>=0==0)throw new TypeError(`Spica: sqid: A parameter value must be a positive number: ${t}`);if(t%1!=0)throw new TypeError(`Spica: sqid: A parameter value must be an integer: ${t}`);return(i+t).slice(-16)}},{"./global":20}],88:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.Supervisor=void 0;const i=e("./global"),s=e("./alias"),o=e("./coroutine"),c=e("./promise"),a=e("./future"),u=e("./observer"),l=e("./array"),h=e("./assign"),d=e("./clock"),p=e("./sqid"),f=e("./exception");class m extends o.Coroutine{constructor(e={}){if(super(async function*(){return this.state},{delay:!1}),this.state=new a.AtomicFuture,this.id=p.sqid(),this.settings={name:"",size:i.Infinity,timeout:i.Infinity,destructor:e=>void 0,scheduler:d.tick,resource:10},this.events_={init:new u.Observation,loss:new u.Observation,exit:new u.Observation},this.events=this.events_,this.workers=new i.Map,this.alive=!0,this.available=!0,this[n]={ask:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},recv:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},send:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},connect:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)}},this.scheduled=!1,this.messages=[],h.extend(this.settings,e),this.name=this.settings.name,this.constructor===m)throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot instantiate abstract classes.`);this.constructor.instances.add(this)}static get instances(){return this.hasOwnProperty("instances_")?this.instances_:this.instances_=new i.Set}static get count(){return this.instances.size}static get procs(){return[...this.instances].reduce((e,t)=>e+t.workers.size,0)}static clear(e){for(;this.instances.size>0;)for(const t of this.instances)t.terminate(e)}destructor(e){for(this.available=!1,this.clear(e),s.ObjectFreeze(this.workers);this.messages.length>0;){const[e,t]=this.messages.shift(),r="string"==typeof e?e:e[Symbol.iterator]().next().value;this.events_.loss.emit([r],[r,t])}this.alive=!1,this.constructor.instances.delete(this),s.ObjectFreeze(this),this.settings.destructor(e),this.state.bind(void 0===e?void 0:c.AtomicPromise.reject(e))}throwErrorIfNotAvailable(){if(!this.available)throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: A supervisor is already terminated.`)}register(e,t,r){if(r=r,this.throwErrorIfNotAvailable(),o.isCoroutine(t)){const n=t[t.constructor.port],i={init:e=>e,main:(e,t,r)=>n.ask(e).then(({value:e,done:n})=>n&&void r()||[e,t]),exit:e=>void t[t.constructor.terminate](e)};this.constructor.standalone.add(i);const s=this.register(e,i,r);return t.catch(s),s}if(function(e){return"AsyncGeneratorFunction"===e[Symbol.toStringTag]}(t)){let n;return this.register(e,{init:(e,r)=>(n=t(e,r),n.next().catch(r),e),main:(e,t,r)=>c.AtomicPromise.resolve(n.next(e)).then(({value:e,done:n})=>n&&void r()||[e,t]),exit:()=>void 0},r)}if("function"==typeof t){if(function(e){return"GeneratorFunction"===e[Symbol.toStringTag]}(t)){let n;return this.register(e,{init:(e,r)=>(n=t(e,r),n.next(),e),main:(e,t,r)=>{const{value:i,done:s}=n.next(e);return s&&r(),[i,t]},exit:()=>void 0},r)}return this.register(e,{init:e=>e,main:t,exit:()=>void 0},r)}if(this.workers.has(e))throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}/${e}>: Cannot register a process multiply with the same name.`);this.schedule();const n=new b(e,t,r,this,()=>void this.schedule(),this.constructor.standalone.has(t),this.events_,()=>this.workers.get(e)===n&&void this.workers.delete(e));return this.workers.set(e,n),n.terminate}call(e,t,r=this.settings.timeout,n=this.settings.timeout){if("function"!=typeof r)return new c.AtomicPromise((n,i)=>void this.call(e,t,(e,t)=>t?i(t):n(e),r));for(this.messages.push(["string"==typeof e?e:new v(this.workers,e),t,r,Date.now()+n]);this.messages.length>(this.available?this.settings.size:0);){const[e,t,r]=this.messages.shift(),n="string"==typeof e?e:e[Symbol.iterator]().next().value;this.events_.loss.emit([n],[n,t]);try{r(void 0,new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: A message overflowed.`))}catch(e){f.causeAsyncException(e)}}this.throwErrorIfNotAvailable(),this.schedule(),n>0&&n!==i.Infinity&&i.setTimeout(()=>void this.schedule(),n+3)}cast(e,t,r=this.settings.timeout){var n;let i;for(e of(this.throwErrorIfNotAvailable(),"string"==typeof e?[e]:new v(this.workers,e)))if(i=null===(n=this.workers.get(e))||void 0===n?void 0:n.call([t,Date.now()+r]))break;return e=e,!!i||(this.events_.loss.emit([e],[e,t]),!1)}refs(e){return void 0===e?[...this.workers.values()].map(t):this.workers.has(e)?[t(this.workers.get(e))]:[];function t(e){return[e.name,e.process,e.state,e.terminate]}}kill(e,t){return!!this.available&&(!!this.workers.has(e)&&this.workers.get(e).terminate(t))}clear(e){for(;this.workers.size>0;)for(const t of this.workers.values())t.terminate(e)}terminate(e){return!!this.available&&(this.destructor(e),this[o.Coroutine.exit](void 0),!0)}[o.Coroutine.terminate](e){this.terminate(e)}schedule(){if(!this.available||this.scheduled||0===this.messages.length)return;const e=new a.AtomicFuture(!1);e.finally(()=>{this.scheduled=!1,this.deliver()}),d.tick(()=>{this.settings.scheduler.call(void 0,e.bind),this.settings.scheduler===requestAnimationFrame&&i.setTimeout(e.bind,1e3)}),this.scheduled=!0}deliver(){var e;if(!this.available)return;const t=Date.now();for(let r=0,n=this.messages.length;this.available&&r<n;++r){if(this.settings.resource-(Date.now()-t)<=0)return void this.schedule();const[s,o,c,a]=this.messages[r];let u,h;for(h of"string"==typeof s?[s]:s)if(u=null===(e=this.workers.get(h))||void 0===e?void 0:e.call([o,a]))break;if(!(void 0===u&&Date.now()<a))if(l.splice(this.messages,r,1),--r,--n,void 0===u){this.events_.loss.emit([h],[h,o]);try{c(void 0,new i.Error("Spica: Supervisor: A process has failed."))}catch(e){f.causeAsyncException(e)}}else u.then(e=>void c(e),()=>void c(void 0,new i.Error("Spica: Supervisor: A process has failed.")))}}}r.Supervisor=m,n=o.Coroutine.port,m.standalone=new i.WeakSet;class v{constructor(e,t=(e=>e)){this.workers=e,this.selector=t}*[Symbol.iterator](){let e=0;for(const t of this.selector(this.workers.keys()))++e,yield t;0===e&&(yield"")}}class b{constructor(e,t,r,n,i,s,o,c){this.name=e,this.process=t,this.state=r,this.sv=n,this.schedule=i,this.events=o,this.destructor_=c,this.alive=!0,this.available=!0,this.initiated=!1,this.terminate=(e=>!!this.alive&&(this.destructor(e),!0)),s&&this.init()}destructor(e){this.alive=!1,this.available=!1,s.ObjectFreeze(this);try{this.destructor_()}catch(e){f.causeAsyncException(e)}this.initiated&&this.exit(e)}init(){this.initiated=!0,this.events.init.emit([this.name],[this.name,this.process,this.state]),this.state=this.process.init(this.state,this.terminate)}exit(e){try{this.process.exit(e,this.state),this.events.exit.emit([this.name],[this.name,this.process,this.state,e])}catch(t){this.events.exit.emit([this.name],[this.name,this.process,this.state,e]),this.sv.terminate(t)}}call([e,t]){const r=Date.now();if(this.available&&!(r>t))return new c.AtomicPromise((n,o)=>{s.isFinite(t)&&i.setTimeout(()=>void o(new i.Error),t-r),this.available=!1,this.initiated||(this.init(),this.alive)?c.AtomicPromise.resolve(this.process.main(e,this.state,this.terminate)).then(n,o):o()}).then(([e,t])=>(this.alive&&(this.schedule(),this.state=t,this.available=!0),e)).catch(e=>{throw this.schedule(),this.terminate(e),e})}}},{"./alias":4,"./array":5,"./assign":6,"./clock":11,"./coroutine":13,"./exception":16,"./future":19,"./global":20,"./observer":83,"./promise":84,"./sqid":87}],89:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.debounce=r.throttle=void 0;const n=e("./list"),i=e("./global");r.throttle=function(e,t){let r=0,s=n.MList();return o=>{s.prepend(o),r>0||(r=i.setTimeout(()=>{r=0;const e=s;s=n.MList(),t(e.head,e)},e))}},r.debounce=function(e,t){let r=0,s=n.MList();return o=>{s.prepend(o),r>0||(r=i.setTimeout(()=>{r=0,i.setTimeout(()=>{if(r>0)return;const e=s;s=n.MList(),t(e.head,e)},s.length>1?e:0)},e))}}},{"./global":20,"./list":23}],90:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.tuple=void 0,r.tuple=function(...e){return e}},{}],91:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isPrimitive=r.isType=r.type=void 0;const n=e("./global"),i=e("./alias"),s=n.Object.prototype.toString.call.bind(n.Object.prototype.toString);function o(e){if(e===n.undefined)return"undefined";if(null===e)return"null";const t=typeof e;if("object"===t){const t=i.ObjectGetPrototypeOf(e);return t===n.Object.prototype||null===t?"Object":t===n.Array.prototype?"Array":s(e).slice(8,-1)}return"function"===t?"Function":t}r.type=o,r.isType=function(e,t){return"object"===t?null!==e&&typeof e===t:"function"===t?typeof e===t:o(e)===t},r.isPrimitive=function(e){const t=typeof e;return"object"!==t&&"function"!==t||null===e}},{"./alias":4,"./global":20}],92:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.URL=r.ReadonlyURL=r.standardize=void 0;const n=e("./global"),i=e("./url/format");var s=e("./url/format");Object.defineProperty(r,"standardize",{enumerable:!0,get:function(){return s.standardize}});var o=e("./url/format");Object.defineProperty(r,"ReadonlyURL",{enumerable:!0,get:function(){return o.ReadonlyURL}});const c=Symbol.for("spica/url::internal");r.URL=class{constructor(e,t){this.url=e,this.base=t,this[c]={url:new i.ReadonlyURL(e,t),searchParams:n.undefined}}get href(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,`${this[c].url.href.slice(0,-this[c].url.query.length-this[c].url.fragment.length||this[c].url.href.length)}?`).concat(this.fragment))&&void 0!==t?t:this[c].url.href}get resource(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,`${this[c].url.href.slice(0,-this[c].url.query.length-this[c].url.fragment.length||this[c].url.href.length)}?`))&&void 0!==t?t:this[c].url.resource}get origin(){return this[c].url.origin}get scheme(){return this[c].url.protocol.slice(0,-1)}get protocol(){return this[c].url.protocol}get username(){return this[c].url.username}get password(){return this[c].url.password}get host(){return this[c].url.host}get hostname(){return this[c].url.hostname}get port(){return this[c].url.port}get path(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,`${this.pathname}?`))&&void 0!==t?t:this[c].url.path}get pathname(){return this[c].url.pathname}get search(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,"?"))&&void 0!==t?t:this[c].url.search}get query(){var e,t;return null!==(t=null===(e=this[c].searchParams)||void 0===e?void 0:e.toString().replace(/^(?=.)/,"?"))&&void 0!==t?t:this[c].url.query}get hash(){return this[c].url.hash}get fragment(){return this[c].url.fragment}get searchParams(){return this[c].searchParams===n.undefined?this[c].searchParams=new n.URLSearchParams(this.search):this[c].searchParams}toString(){return this.href}toJSON(){return this.href}}},{"./global":20,"./url/format":93}],93:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ReadonlyURL=r._encode=r.standardize=void 0;const n=e("../global"),i=e("../memoize"),s=e("../cache"),o=e("../flip"),c=e("../curry");function a(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,e=>2===e.length?e:"").replace(/%(?![0-9A-F]{2})|[^%\[\]]+/gi,n.encodeURI).replace(/\?[^#]+/,e=>"?"+e.slice(1).replace(/%[0-9A-F]{2}|%|[^=&]+/gi,e=>"%"===e[0]&&3===e.length?e:n.encodeURIComponent(e))).replace(/%[0-9A-F]{2}/gi,e=>e.toUpperCase()).replace(/#.+/,e.slice(e.indexOf("#")))}r.standardize=function(e,t){const r=new l(e,t);return a(e="null"!==r.origin?r.origin.toLowerCase()+r.href.slice(r.origin.length):r.protocol.toLowerCase()+r.href.slice(r.protocol.length))},r._encode=a;const u=Symbol.for("spica/url::internal");class l{constructor(e,t){var r,i;this.src=e,this.base=t;const s=null!==(r=null==t?void 0:t.indexOf("#"))&&void 0!==r?r:-1;s>-1&&(t=null==t?void 0:t.slice(0,s));const o=null!==(i=null==t?void 0:t.indexOf("?"))&&void 0!==i?i:-1;s>-1&&-1===e.indexOf("#")&&(t=null==t?void 0:t.slice(0,o)),this[u]={share:l.get(e,t),searchParams:n.undefined}}get href(){return this[u].share.href===n.undefined?this[u].share.href=this[u].share.url.href:this[u].share.href}get resource(){return this[u].share.resource===n.undefined?this[u].share.resource=this.href.slice(0,-this.fragment.length-this.query.length||this.href.length)+this.search:this[u].share.resource}get origin(){return this[u].share.origin===n.undefined?this[u].share.origin=this[u].share.url.origin:this[u].share.origin}get protocol(){return this[u].share.protocol===n.undefined?this[u].share.protocol=this[u].share.url.protocol:this[u].share.protocol}get username(){return this[u].share.username===n.undefined?this[u].share.username=this[u].share.url.username:this[u].share.username}get password(){return this[u].share.password===n.undefined?this[u].share.password=this[u].share.url.password:this[u].share.password}get host(){return this[u].share.host===n.undefined?this[u].share.host=this[u].share.url.host:this[u].share.host}get hostname(){return this[u].share.hostname===n.undefined?this[u].share.hostname=this[u].share.url.hostname:this[u].share.hostname}get port(){return this[u].share.port===n.undefined?this[u].share.port=this[u].share.url.port:this[u].share.port}get path(){return this[u].share.path===n.undefined?this[u].share.path=`${this.pathname}${this.search}`:this[u].share.path}get pathname(){return this[u].share.pathname===n.undefined?this[u].share.pathname=this[u].share.url.pathname:this[u].share.pathname}get search(){return this[u].share.search===n.undefined?this[u].share.search=this[u].share.url.search:this[u].share.search}get query(){return this[u].share.query===n.undefined?this[u].share.query=this.search||"?"===this.href[this.href.length-this.fragment.length-1]&&"?"||"":this[u].share.query}get hash(){return this[u].share.hash===n.undefined?this[u].share.hash=this[u].share.url.hash:this[u].share.hash}get fragment(){return this[u].share.fragment===n.undefined?this[u].share.fragment=this.hash||"#"===this.href[this.href.length-1]&&"#"||"":this[u].share.fragment}get searchParams(){return this[u].searchParams===n.undefined?this[u].searchParams=new n.URLSearchParams(this.search):this[u].searchParams}toString(){return this.href}toJSON(){return this.href}}r.ReadonlyURL=l,l.get=o.flip(c.uncurry(i.memoize(e=>i.memoize(t=>({url:new n.global.URL(t,e),href:n.undefined,resource:n.undefined,origin:n.undefined,protocol:n.undefined,username:n.undefined,password:n.undefined,host:n.undefined,hostname:n.undefined,port:n.undefined,path:n.undefined,pathname:n.undefined,search:n.undefined,query:n.undefined,hash:n.undefined,fragment:n.undefined}),new s.Cache(100)),new s.Cache(100))))},{"../cache":7,"../curry":14,"../flip":17,"../global":20,"../memoize":25}],94:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.identity=r.apply=r.currentTarget=r.wait=r.once=r.bind=r.delegate=r.listen=r.define=r.element=r.text=r.svg=r.html=r.frag=r.shadow=r.proxy=r.API=r.SVG=r.HTML=r.Shadow=void 0,e("spica/global");var n=e("./src/builder");Object.defineProperty(r,"Shadow",{enumerable:!0,get:function(){return n.Shadow}}),Object.defineProperty(r,"HTML",{enumerable:!0,get:function(){return n.HTML}}),Object.defineProperty(r,"SVG",{enumerable:!0,get:function(){return n.SVG}}),Object.defineProperty(r,"API",{enumerable:!0,get:function(){return n.API}});var i=e("./src/proxy");Object.defineProperty(r,"proxy",{enumerable:!0,get:function(){return i.proxy}});var s=e("./src/util/dom");Object.defineProperty(r,"shadow",{enumerable:!0,get:function(){return s.shadow}}),Object.defineProperty(r,"frag",{enumerable:!0,get:function(){return s.frag}}),Object.defineProperty(r,"html",{enumerable:!0,get:function(){return s.html}}),Object.defineProperty(r,"svg",{enumerable:!0,get:function(){return s.svg}}),Object.defineProperty(r,"text",{enumerable:!0,get:function(){return s.text}}),Object.defineProperty(r,"element",{enumerable:!0,get:function(){return s.element}}),Object.defineProperty(r,"define",{enumerable:!0,get:function(){return s.define}});var o=e("./src/util/listener");Object.defineProperty(r,"listen",{enumerable:!0,get:function(){return o.listen}}),Object.defineProperty(r,"delegate",{enumerable:!0,get:function(){return o.delegate}}),Object.defineProperty(r,"bind",{enumerable:!0,get:function(){return o.bind}}),Object.defineProperty(r,"once",{enumerable:!0,get:function(){return o.once}}),Object.defineProperty(r,"wait",{enumerable:!0,get:function(){return o.wait}}),Object.defineProperty(r,"currentTarget",{enumerable:!0,get:function(){return o.currentTarget}});var c=e("./src/util/query");Object.defineProperty(r,"apply",{enumerable:!0,get:function(){return c.apply}});var a=e("./src/util/identity");Object.defineProperty(r,"identity",{enumerable:!0,get:function(){return a.identity}})},{"./src/builder":95,"./src/proxy":96,"./src/util/dom":97,"./src/util/identity":98,"./src/util/listener":99,"./src/util/query":100,"spica/global":20}],95:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SVG=r.HTML=r.Shadow=r.API=void 0;const n=e("spica/global"),i=e("spica/alias"),s=e("./proxy"),o=e("./util/dom");function c(e,t=(e=>e)){return new Proxy(()=>n.undefined,function(e,t){return{apply(e,t,[r,...n]){return this.get(e,r,e)(...n)},get:(r,c)=>r[c]||c in r||"string"!=typeof c?r[c]:r[c]=function(e,r){return function a(u,l,h){if("function"==typeof u)return a(n.undefined,n.undefined,u);if("function"==typeof l)return a(u,n.undefined,l);if(u!==n.undefined&&function(e){return"object"!=typeof e||i.ObjectValues(e).slice(-1).every(e=>"object"==typeof e)}(u))return a(n.undefined,u,h);const d=t(function(t,n,s){const a=t(r,e,n||{},s);if(e!==a.tagName.toLowerCase())throw new Error(`TypedDOM: Expected tag name is "${e}" but actually "${a.tagName.toLowerCase()}".`);if(t!==c){if(n)for(let e=0,t=i.ObjectKeys(n);e<t.length;++e){const r=t[e],i=n[r];"function"==typeof i&&a.removeEventListener(r,i)}o.define(a,n)}return a}(h||c,u,l));return 1===d.nodeType?new s.Elem(d,l):new s.Elem(d.host,l,d)};function c(e,t,r){return e(t,r)}}(c,e)}}(e,t))}r.API=c,r.Shadow=c(o.html,o.shadow),r.HTML=c(o.html),r.SVG=c(o.svg)},{"./proxy":96,"./util/dom":97,"spica/alias":4,"spica/global":20}],96:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Elem=r.proxy=void 0;const n=e("spica/global"),i=e("spica/alias"),s=e("./util/identity"),o=e("./util/dom"),c=e("spica/array"),a=new n.WeakMap;function u(e){const t=a.get(e);if(t)return t;throw new Error("TypedDOM: This element has no proxy.")}r.proxy=u;Symbol.for("typed-dom::tag");const l=s.identity();let h=0;function d({element:e}){if(e.parentElement&&a.has(e.parentElement))throw new Error("TypedDOM: Typed DOM children must not be used to another typed DOM.")}r.Elem=class{constructor(e,t,r=e){switch(this.element=e,this.children_=t,this.container=r,this.id_="",this.query_="",this.isPartialUpdate=!1,this.isInit=!0,!0){case t===n.undefined:this.type=0;break;case"string"==typeof t:this.type=1;break;case i.isArray(t):this.type=2;break;case t&&"object"==typeof t:this.type=3;break;default:throw new Error("TypedDOM: Invalid type children.")}switch(d(this),a.set(this.element,this),this.type){case 0:return void(this.isInit=!1);case 1:return o.define(this.container,[]),this.children_=this.container.appendChild(o.text("")),this.children=t,void(this.isInit=!1);case 2:return o.define(this.container,[]),this.children_=[],this.children=t,void(this.isInit=!1);case 3:return o.define(this.container,[]),this.children_=this.observe({...t}),this.children=t,void(this.isInit=!1);default:throw new Error("TypedDOM: Unreachable code.")}}get id(){return this.id_?this.id_:(this.id_=this.element.id,/^[\w-]+$/.test(this.id_)?this.id_:(this.id_=`rnd-${l}-${++h}`,this.element.classList.add(this.id_),this.id_))}get query(){if(this.query_)return this.query_;switch(!0){case this.element!==this.container:return this.query_=":host";case this.id===this.element.id:return this.query_=`#${this.id}`;default:return this.query_=`.${this.id}`}}observe(e){const t={};for(const r of i.ObjectKeys(e)){if(r in{})continue;let n=e[r];d(n),this.container.appendChild(n.element),t[r]={configurable:!0,enumerable:!0,get:()=>n,set:e=>{const t=n;if(e!==t)if(this.isPartialUpdate)if(n=e,e.element.parentNode===t.element.parentNode){const r=e.element.nextSibling!==t.element?e.element.nextSibling:t.element.nextSibling;this.container.replaceChild(e.element,t.element),this.container.insertBefore(t.element,r)}else this.container.insertBefore(e.element,t.element),this.container.removeChild(t.element);else this.children={...this.children_,[r]:e}}}}return i.ObjectDefineProperties(e,t)}scope(e){const t=e.element;switch(!1){case"type"in t:case"media"in t:case"STYLE"===t.tagName:return}const r=/(^|[,}])(\s*)\$scope(?![\w-])(?=[^;{}]*{)/g,n=t.innerHTML;if(-1===n.search(r))return;const i=this.query;if(t.innerHTML=n.replace(r,(e,t,r)=>`${t}${r}${i}`),t.firstElementChild)for(let e=t.children,r=0,n=e.length;r<n;++r)e[0].remove()}get children(){switch(this.type){case 1:if(this.children_.parentNode!==this.container){this.children_=n.undefined;for(let e=this.container.childNodes,t=0,r=e.length;t<r;++t){const r=e[t];if("wholeText"in r!=0){this.children_=r;break}}}return this.children_.data;default:return this.children_}}set children(e){const t=[],r=[];let s=!1;switch(this.type){case 0:return;case 1:{if(!this.isInit&&e===this.children)return;const t=this.children_,r=t.data,i=e;if(t.data=i,i===r)return;return void this.element.dispatchEvent(new n.Event("change",{bubbles:!1,cancelable:!0}))}case 2:{const n=e,i=[];this.children_=i;const o=this.container.children;for(let e=0;e<n.length;++e){const t=n[e],c=o[e];t.element.parentNode!==this.container&&d(t),t.element!==c&&(t.element.parentNode!==this.container&&(this.scope(t),r.push(t)),this.container.insertBefore(t.element,c),s=!0),i.push(t)}for(let e=o.length;n.length<e--;){const e=o[n.length];a.has(e)&&(t.push(u(this.container.removeChild(e))),s=!0)}break}case 3:{const n=e,o=this.children_;for(const e of i.ObjectKeys(o)){const i=o[e],a=n[e];if(this.isInit||a!==i){if(a.element.parentNode!==this.container&&d(a),(this.isInit||a!==i&&a.element.parentNode!==i.element.parentNode)&&(this.scope(a),r.push(a),!this.isInit)){let e=0;(e=t.lastIndexOf(a))>-1&&c.splice(t,e,1),t.push(i),(e=r.lastIndexOf(i))>-1&&c.splice(r,e,1)}this.isPartialUpdate=!0,o[e]=n[e],this.isPartialUpdate=!1,s=!0}}break}}if(t.length){const e=new n.Event("disconnect",{bubbles:!1,cancelable:!0});for(const{element:r}of t)r.dispatchEvent(e)}if(r.length){const e=new n.Event("connect",{bubbles:!1,cancelable:!0});for(const{element:t}of r)t.dispatchEvent(e)}s&&this.element.dispatchEvent(new n.Event("change",{bubbles:!1,cancelable:!0}))}}},{"./util/dom":97,"./util/identity":98,"spica/alias":4,"spica/array":5,"spica/global":20}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.define=r.element=r.text=r.svg=r.html=r.frag=r.shadow=void 0;const n=e("spica/global"),i=e("spica/alias"),s=e("spica/memoize"),o=e("spica/array");var c;function a(e){return n.document.createTextNode(e)}function u(e,t){const r=s.memoize(l,(e,t,r)=>`${t}:${r}`);return(n,i,s)=>{const o=n.includes("-")?l(e,t,n):r(e,t,n).cloneNode(!0);return p(i)?d(o,i):d(h(o,i),s)}}function l(e,t,r){if(!("createElement"in e))throw new Error("TypedDOM: Scoped custom elements are not supported on this browser.");switch(t){case"HTML":return e.createElement(r);case"SVG":return e.createElementNS("http://www.w3.org/2000/svg",r)}}function h(e,t){if(!t)return e;for(let r=0,n=i.ObjectKeys(t);r<n.length;++r){const i=n[r],s=t[i];switch(typeof s){case"string":e.setAttribute(i,s);continue;case"function":if(i.length<3)throw new Error(`TypedDOM: Attribute names for event listeners must have an event name but got "${i}".`);if("on"!==i.slice(0,2))throw new Error(`TypedDOM: Attribute names for event listeners must start with "on" but got "${i}".`);e.addEventListener(i.slice(2),s,{passive:["wheel","mousewheel","touchstart","touchmove","touchend","touchcancel"].includes(i.slice(2))});continue;case"object":e.removeAttribute(i);continue;default:continue}}return e}function d(e,t){switch(typeof t){case"undefined":return e;case"string":return d(e,[t])}if(!("length"in t)){if(e.firstChild)return d(e,o.push([],t));for(const r of t)e.append(r);return e}if(!i.isArray(t)){if(e.firstChild)return d(e,o.push([],t));for(let r=t.length;r--;)e.prepend(t[r]);return e}const r=e.firstChild?e.childNodes:[];let n=r.length;if(0===n)return m(e,t);let s=0;e:for(let i=0;i<t.length;++i){if(s===n)return m(e,t,i);const o=t[i];if("object"==typeof o&&11===o.nodeType){const t=o.childNodes.length;n+=o!==e?t:0,e.insertBefore(o,r[s]||null),s+=t;continue}for(++s;n>t.length;){const e=r[s-1];if(f(e,o))continue e;e.remove(),--n}const c=r[s-1];f(c,o)||(n<t.length-i+s?(n+="string"==typeof o||o.parentNode!==e?1:0,e.insertBefore("string"==typeof o?a(o):o,c)):e.replaceChild("string"==typeof o?a(o):o,c))}for(;s<n;)r[s].remove(),--n;return e}function p(e){return!!(null==e?void 0:e[n.Symbol.iterator])}function f(e,t){return"string"==typeof t?"wholeText"in e&&e.data===t:e===t}function m(e,t,r=0){for(let n=t.length;r<n;++r)e.append(t[r]);return e}!function(e){e.shadows=new WeakMap,e.fragment=n.document.createDocumentFragment()}(c||(c={})),r.shadow=function e(t,i,s){if("string"==typeof t)return e(r.html(t),i,s);if(i&&!p(i))return e(t,n.undefined,i);const o=s===n.undefined?t.shadowRoot||c.shadows.get(t):"open"===s.mode?t.shadowRoot||n.undefined:c.shadows.get(t);return d(s&&"open"!==s.mode?o||c.shadows.set(t,t.attachShadow(s)).get(t):o||t.attachShadow(s||{mode:"open"}),o||i!=n.undefined?i:t.childNodes)},r.frag=function(e){return d(c.fragment.cloneNode(!0),e)},r.html=u(n.document,"HTML"),r.svg=u(n.document,"SVG"),r.text=a,r.element=u,r.define=function(e,t,r){return p(t)?d(e,t):d(h(e,t),r)}},{"spica/alias":4,"spica/array":5,"spica/global":20,"spica/memoize":25}],98:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.identity=void 0;const i=e("spica/global"),s=e("spica/random"),o=Symbol.for("typed-dom::ids");r.identity=s.unique(s.rnd0Z,2,null!==(n=i.global[o])&&void 0!==n?n:i.global[o]=new i.Set)},{"spica/global":20,"spica/random":85}],99:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.bind=r.delegate=r.wait=r.once=r.listen=r.currentTarget=void 0;const n=e("spica/global"),i=e("spica/promise"),s=e("spica/function"),o=e("spica/noop");function c(e,t,r,n=!1,i={}){return"string"==typeof r?a(e,t,r,n,{..."boolean"==typeof i?{capture:i}:i,once:!0}):u(e,t,r,{..."boolean"==typeof n?{capture:n}:n,once:!0})}function a(e,t,r,i,s={}){let a=o.noop;return u(e,r,e=>{var o,u;a();const l=e.target.shadowRoot?null===(o=e.composedPath()[0])||void 0===o?void 0:o.closest(t):null===(u=e.target)||void 0===u?void 0:u.closest(t);return l?a=c(l,r,i,s):n.undefined,e.returnValue},{...s,capture:!0})}function u(e,t,i,o=!1){return e.addEventListener(t,c,o),s.once(()=>void e.removeEventListener(t,c,o));function c(e){return r.currentTarget in e&&!e[r.currentTarget]?n.undefined:e[r.currentTarget]=e.currentTarget,i(e)}}r.currentTarget=Symbol.for("typed-dom::currentTarget"),r.listen=function(e,t,r,n=!1,i={}){return"string"==typeof r?a(e,t,r,n,i):u(e,t,r,n)},r.once=c,r.wait=function(e,t,r=!1,n={}){return new i.AtomicPromise(i=>"string"==typeof r?c(e,t,r,i,n):c(e,t,i,r))},r.delegate=a,r.bind=u},{"spica/function":18,"spica/global":20,"spica/noop":82,"spica/promise":84}],100:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.apply=void 0;const n=e("./dom");r.apply=function(e,t,r){const i=e.querySelectorAll(t);for(let e=0,t=i.length;e<t;++e)n.define(i[e],r);return i}},{"./dom":97}],101:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.router=r.default=r.Pjax=void 0;var n=e("./layer/interface/service/gui");Object.defineProperty(r,"Pjax",{enumerable:!0,get:function(){return n.GUI}}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return n.GUI}});var i=e("./lib/router");Object.defineProperty(r,"router",{enumerable:!0,get:function(){return i.router}})},{"./layer/interface/service/gui":130,"./lib/router":140}],102:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.route=r.scope=r.Config=r.RouterEventSource=r.RouterEventType=r.RouterEvent=void 0;const n=e("../domain/router/api");var i=e("../domain/event/router");Object.defineProperty(r,"RouterEvent",{enumerable:!0,get:function(){return i.RouterEvent}}),Object.defineProperty(r,"RouterEventType",{enumerable:!0,get:function(){return i.RouterEventType}}),Object.defineProperty(r,"RouterEventSource",{enumerable:!0,get:function(){return i.RouterEventSource}});var s=e("../domain/data/config");Object.defineProperty(r,"Config",{enumerable:!0,get:function(){return s.Config}}),Object.defineProperty(r,"scope",{enumerable:!0,get:function(){return s.scope}}),r.route=function(e,t,r,i){return n.route(new n.RouterEntity(e,t,new n.RouterEntityState(r.process,r.scripts)),i)}},{"../domain/data/config":105,"../domain/event/router":107,"../domain/router/api":108}],103:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.savePosition=r.loadTitle=void 0;var n=e("../domain/store/path");Object.defineProperty(r,"loadTitle",{enumerable:!0,get:function(){return n.loadTitle}}),Object.defineProperty(r,"savePosition",{enumerable:!0,get:function(){return n.savePosition}})},{"../domain/store/path":124}],104:[function(e,t,r){"use strict";function n(){window.history.replaceState({...window.history.state,title:document.title},document.title)}function i(){var e;window.history.replaceState({...window.history.state,position:{...null===(e=window.history.state)||void 0===e?void 0:e.position,top:window.pageYOffset,left:window.pageXOffset}},document.title)}Object.defineProperty(r,"__esModule",{value:!0}),r.savePjax=r.isTransitable=r.savePosition=r.loadPosition=r.saveTitle=r.loadTitle=void 0,n(),i(),r.loadTitle=function(){var e;return(null===(e=window.history.state)||void 0===e?void 0:e.title)||document.title},r.saveTitle=n,r.loadPosition=function(){var e;return(null===(e=window.history.state)||void 0===e?void 0:e.position)||{top:window.pageYOffset,left:window.pageXOffset}},r.savePosition=i,r.isTransitable=function(e){var t;return(null===(t=null==e?void 0:e.pjax)||void 0===t?void 0:t.transition)||!1},r.savePjax=function(){var e;window.history.replaceState({...window.history.state,pjax:{...null===(e=window.history.state)||void 0===e?void 0:e.pjax,transition:!0}},document.title)}},{}],105:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Config=r.scope=void 0;const n=e("spica/assign");var i=e("./config/scope");Object.defineProperty(r,"scope",{enumerable:!0,get:function(){return i.scope}});r.Config=class{constructor(e){this.areas=["body"],this.link="a, area",this.form="form:not([method])",this.replace="",this.fetch={rewrite:e=>e,cache:(e,t)=>"",headers:new Headers,timeout:3e3,wait:0},this.update={rewrite:(e,t)=>void 0,head:"base, meta, link",css:!0,script:!0,ignore:"",ignores:{extension:'[href^="chrome-extension://"]',security:'[src*=".scr.kaspersky-labs.com/"]'},reload:"",logger:""},this.sequence=new s,this.progressbar="display:none;position:absolute;bottom:0;left:0;width:0;height:2px;background:rgb(40, 105, 255);",this.scope={},Object.defineProperties(this.update,{ignore:{enumerable:!1,set(e){this.ignores._=e},get(){return Object.keys(this.ignores).map(e=>this.ignores[e]).filter(e=>e.trim().length>0).join(",")}}}),n.extend(this,e),this.fetch.headers=new Headers(this.fetch.headers),Object.freeze(this),this.fetch.headers.set("X-Requested-With","XMLHttpRequest"),this.fetch.headers.set("X-Pjax","1")}filter(e){return e.matches("[href]:not([target])")}fallback(e,t){if(e instanceof HTMLAnchorElement)window.location.assign(e.href);else if(e instanceof HTMLFormElement)window.location.assign(e.action);else{if(!(e instanceof Window))throw t;window.location.reload(!0)}}};class s{async fetch(){return"fetch"}async unload(){return"unload"}async content(){return"content"}async ready(){return"ready"}async load(){}}},{"./config/scope":106,"spica/assign":6}],106:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scope=void 0;const n=e("../../../../lib/router"),i=e("../../../domain/data/config"),s=e("spica/sequence"),o=e("spica/maybe"),c=e("spica/assign");r.scope=function(e,t){const r={"/":{},...e.scope};return s.Sequence.from(Object.keys(r).sort().reverse()).dropWhile(e=>!n.compare(e,t.orig)&&!n.compare(e,t.dest)).take(1).filter(e=>!!n.compare(e,t.orig)&&n.compare(e,t.dest)).map(e=>r[e]).map(t=>t?o.Just(new i.Config(c.extend({},e,t))):o.Nothing).extract().reduce((e,t)=>t,o.Nothing)}},{"../../../../lib/router":140,"../../../domain/data/config":105,"spica/assign":6,"spica/maybe":24,"spica/sequence":86}],107:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RouterEventLocation=r.RouterEventRequest=r.RouterEventMethod=r.RouterEventType=r.RouterEventSource=r.RouterEvent=void 0;const n=e("../../../lib/dom"),i=e("spica/url"),s=e("typed-dom");var o,c;r.RouterEvent=class{constructor(e){this.original=e,this.type=this.original.type.toLowerCase(),this.source=this.original[s.currentTarget],this.request=new a(this.source),this.location=new u(this.request.url),Object.freeze(this)}},function(e){e.Anchor=HTMLAnchorElement,e.Area=HTMLAreaElement,e.Form=HTMLFormElement,e.Window=window.Window}(o=r.RouterEventSource||(r.RouterEventSource={})),function(e){e.Click="click",e.Submit="submit",e.Popstate="popstate"}(r.RouterEventType||(r.RouterEventType={})),function(e){e.GET="GET",e.POST="POST"}(c=r.RouterEventMethod||(r.RouterEventMethod={}));class a{constructor(e){this.source=e,this.method=(()=>{if(this.source instanceof o.Anchor||this.source instanceof o.Area)return c.GET;if(this.source instanceof o.Form)return this.source.method.toUpperCase()===c.POST?c.POST:c.GET;if(this.source instanceof o.Window)return c.GET;throw new TypeError})(),this.url=(()=>{if(this.source instanceof o.Anchor||this.source instanceof o.Area)return new i.URL(i.standardize(this.source.href,window.location.href));if(this.source instanceof o.Form)return this.source.method.toUpperCase()===c.GET?new i.URL(i.standardize(this.source.action.split(/[?#]/)[0]+`?${n.serialize(this.source)}`,window.location.href)):new i.URL(i.standardize(this.source.action.split(/[?#]/)[0],window.location.href));if(this.source instanceof o.Window)return new i.URL(i.standardize(window.location.href));throw new TypeError})(),this.body=(()=>this.source instanceof o.Form&&this.method===c.POST?new FormData(this.source):null)(),Object.freeze(this)}}r.RouterEventRequest=a;class u{constructor(e){this.dest=e,this.orig=new i.URL(i.standardize(window.location.href)),Object.freeze(this)}}r.RouterEventLocation=u},{"../../../lib/dom":137,"spica/url":92,"typed-dom":94}],108:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.route=r.RouterEntityState=r.RouterEntity=void 0;const n=e("./module/fetch"),i=e("./module/update"),s=e("./module/update/content"),o=e("../store/path"),c=e("spica/either");var a=e("./model/eav/entity");Object.defineProperty(r,"RouterEntity",{enumerable:!0,get:function(){return a.RouterEntity}}),Object.defineProperty(r,"RouterEntityState",{enumerable:!0,get:function(){return a.RouterEntityState}}),r.route=async function(e,t){return c.Right(void 0).bind(e.state.process.either).bind(()=>!function(e,t){return s.separate({src:e,dst:e},t).extract(()=>!1,()=>!0)}(t.document,e.config.areas)?c.Left(new Error("Failed to match areas.")):c.Right(void 0)).fmap(()=>n.fetch(e.event.request,e.config,e.state.process)).fmap(async r=>(await r).fmap(([r,n])=>i.update(e,r,n,{document:t.document,position:o.loadPosition})).extract(c.Left)).extract(c.Left)}},{"../store/path":124,"./model/eav/entity":109,"./module/fetch":111,"./module/update":113,"./module/update/content":115,"spica/either":15}],109:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RouterEntityState=r.RouterEntity=void 0;r.RouterEntity=class{constructor(e,t,r){this.config=e,this.event=t,this.state=r,Object.freeze(this)}};r.RouterEntityState=class{constructor(e,t){this.process=e,this.scripts=t,Object.freeze(this)}}},{}],110:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FetchResponse=void 0;const n=e("../../../../../../lib/html"),i=e("spica/url");r.FetchResponse=class{constructor(e,t){if(this.url=e,this.xhr=t,this.header=(e=>this.xhr.getResponseHeader(e)),this.document=this.xhr.responseXML.cloneNode(!0),e.origin!==new i.URL(t.responseURL,window.location.href).origin)throw new Error("Redirected to another origin.");Object.defineProperty(this.document,"URL",{configurable:!0,enumerable:!0,value:e.href,writable:!1}),n.fix(this.document),Object.freeze(this)}}},{"../../../../../../lib/html":139,"spica/url":92}],111:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fetch=void 0;const n=e("../module/fetch/xhr"),i=e("spica/clock");r.fetch=async function({method:e,url:t,body:r},{fetch:{rewrite:s,cache:o,headers:c,timeout:a,wait:u},sequence:l},h){window.dispatchEvent(new Event("pjax:fetch"));const[d,p]=await Promise.all([l.fetch(void 0,{path:t.path,method:e,headers:c,body:r}),n.xhr(e,t,c,r,a,s,o,h),i.wait(u)]);return p.bind(h.either).fmap(e=>[e,d])}},{"../module/fetch/xhr":112,"spica/clock":11}],112:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.match_=r.xhr=void 0;const n=e("../../model/eav/value/fetch"),i=e("spica/promise"),s=e("spica/sequence"),o=e("spica/either"),c=e("spica/cache"),a=e("spica/url"),u=new c.Cache(99),l=new c.Cache(99);function h(e,t){return s.Sequence.intersect(s.Sequence.from(r(e||"").sort()),s.Sequence.from(r(t).sort()),(e,t)=>e.localeCompare(t)).take(1).extract().length>0;function r(e){return e.split(/\s*;\s*/).filter(e=>e.length>0)}}r.xhr=function(e,t,r,s,c,d,p,f){(r=new Headers(r)).set("Accept",r.get("Accept")||"text/html");const m=new a.URL(a.standardize(d(t.path),window.location.href));"GET"===e&&l.has(m.path)&&Date.now()>l.get(m.path).expiry&&r.set("If-None-Match",r.get("If-None-Match")||l.get(m.path).etag);const v="GET"===e&&p(m.path,r)||void 0;return new i.AtomicPromise(i=>{if(v&&u.has(v))return i(o.Right(u.get(v)(t,m)));const d=new XMLHttpRequest;d.open(e,m.path,!0);for(const[e,t]of r)d.setRequestHeader(e,t);d.responseType="document",d.timeout=c,d.send(s),d.addEventListener("abort",()=>void i(o.Left(new Error("Failed to request a page by abort.")))),d.addEventListener("error",()=>void i(o.Left(new Error("Failed to request a page by error.")))),d.addEventListener("timeout",()=>void i(o.Left(new Error("Failed to request a page by timeout.")))),d.addEventListener("load",()=>void function(e,t){return o.Right(e).bind(e=>{const r=new a.URL(a.standardize(e.responseURL,window.location.href));switch(!0){case!e.responseURL:return o.Left(new Error("Failed to get the response URL."));case r.origin!==new a.URL("",window.location.origin).origin:return o.Left(new Error("Redirected to another origin."));case!/2..|304/.test(`${e.status}`):return o.Left(new Error("Failed to validate the status of response."));case!e.response:return"GET"===t&&304===e.status&&l.has(r.path)?o.Right(l.get(r.path).xhr):o.Left(new Error("Failed to get the response body."));case!h(e.getResponseHeader("Content-Type"),"text/html"):return o.Left(new Error("Failed to validate the content type of response."));default:return o.Right(e)}})}(d,e).fmap(t=>{const r=new a.URL(a.standardize(t.responseURL,window.location.href));if("GET"===e){const e=new Map(t.getResponseHeader("Cache-Control")?t.getResponseHeader("Cache-Control").trim().split(/\s*,\s*/).filter(e=>e.length>0).map(e=>e.split("=").concat("")):[]);for(const n of new Set([m.path,r.path]))t.getResponseHeader("ETag")&&!e.has("no-store")?l.set(n,{etag:t.getResponseHeader("ETag"),expiry:e.has("max-age")&&!e.has("no-cache")&&Date.now()+1e3*+e.get("max-age")||0,xhr:t}):l.delete(n)}return(e,i)=>new n.FetchResponse(r.path===i.path?e:i.path!==m.path&&v?e:r,t)}).fmap(e=>(v&&u.set(v,e),e(t,m))).extract(e=>void i(o.Left(e)),e=>void i(o.Right(e)))),f.register(()=>void d.abort())})},r.match_=h},{"../../model/eav/value/fetch":110,"spica/cache":7,"spica/either":15,"spica/promise":84,"spica/sequence":86,"spica/url":92}],113:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.update=void 0;const n=e("../../event/router"),i=e("../module/update/blur"),s=e("../module/update/url"),o=e("../module/update/title"),c=e("../module/update/head"),a=e("../module/update/content"),u=e("../module/update/css"),l=e("../module/update/script"),h=e("../module/update/focus"),d=e("../module/update/scroll"),p=e("../../store/path"),f=e("spica/promise"),m=e("spica/either"),v=e("spica/hlist");r.update=function({event:e,config:t,state:r},b,y,g){const{process:w}=r,S={src:b.document,dst:g.document};return f.AtomicPromise.resolve(y).then(w.either).then(e=>e.bind(()=>a.separate(S,t.areas).extract(()=>m.Left(new Error("Failed to separate the areas.")),()=>e)).fmap(e=>(window.dispatchEvent(new Event("pjax:unload")),t.sequence.unload(e,{...b,url:b.url.href})))).then(e=>m.Either.sequence(e)).then(w.promise).then(e=>e.bind(e=>a.separate(S,t.areas).fmap(([t])=>[e,t]).extract(()=>m.Left(new Error("Failed to separate the areas.")),w.either)).bind(([e,r])=>(t.update.rewrite(S.src,r),a.separate(S,t.areas).fmap(([,t])=>[e,t]).extract(()=>m.Left(new Error("Failed to separate the areas.")),w.either)))).then(w.promise).then(y=>y.fmap(([y,q])=>v.HList().unfold(()=>(i.blur(S.dst),p.savePjax(),s.url(new n.RouterEventLocation(b.url),S.src.title,e.type,e.source,t.replace),p.savePjax(),o.title(S),p.saveTitle(),c.head(S,t.update.head,t.update.ignore),w.either(a.content(S,q)).fmap(([e,t])=>[e,f.AtomicPromise.all(t)]))).unfold(async n=>(await n).fmap(async([n])=>{t.update.css&&u.css(S,t.update.ignore),g.document.dispatchEvent(new Event("pjax:content"));const i=await t.sequence.content(y,n),s=t.update.script?await l.script(S,r.scripts,t.update,10*Math.max(t.fetch.timeout,1e3),w):await w.either([[],f.AtomicPromise.resolve(w.either([]))]);return h.focus(e.type,S.dst),d.scroll(e.type,S.dst,{hash:e.location.dest.fragment,position:g.position}),p.savePosition(),g.document.dispatchEvent(new Event("pjax:ready")),[s.fmap(([e,t])=>[e,t.then(e=>e.extract())]),await t.sequence.ready(i)]}).fmap(e=>e.then(([e,t])=>e.fmap(e=>[e,t]))).extract(e=>f.AtomicPromise.resolve(m.Left(e)))).reverse())).then(w.promise).then(e=>e.fmap(([e,r])=>(f.AtomicPromise.all([e,r]).then(([e,r])=>e.bind(([,e])=>r.fmap(([[,r],n])=>void f.AtomicPromise.all([e,r]).then(w.either).then(e=>e.fmap(([e])=>(window.dispatchEvent(new Event("pjax:load")),void t.sequence.load(n,e))).extract(()=>void 0)))).extract(()=>void 0)),r))).then(e=>m.Either.sequence(e).then(e=>e.join())).then(e=>e.fmap(([e])=>e))}},{"../../event/router":107,"../../store/path":124,"../module/update/blur":114,"../module/update/content":115,"../module/update/css":116,"../module/update/focus":117,"../module/update/head":118,"../module/update/script":119,"../module/update/scroll":120,"../module/update/title":122,"../module/update/url":123,"spica/either":15,"spica/hlist":22,"spica/promise":84}],114:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.blur=void 0,r.blur=function(e){e===window.document&&e.activeElement!==e.body&&(e.activeElement.blur(),e.body.focus())}},{}],115:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._wait=r._split=r.separate=r.content=void 0;const n=e("./script"),i=e("spica/promise"),s=e("spica/maybe"),o=e("spica/array"),c=e("typed-dom");function a(e){return(e.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[]).map(e=>e.trim()).reduce((e,t)=>t?e.fmap(e=>o.push(e,[t])):s.Nothing,s.Just([]))}function u(e){return i.AtomicPromise.race([new i.AtomicPromise(t=>void c.once(e,"load",t)),new i.AtomicPromise(t=>void c.once(e,"abort",t)),new i.AtomicPromise(t=>void c.once(e,"error",t))])}r.content=function(e,t,r={replace:(e,t)=>void t.parentNode.replaceChild(e,t)}){return[t.map(e=>e.dst).reduce(o.push,[]),t.map(function(t){return t.src.map((r,n)=>({src:e.dst.importNode(t.src[n].cloneNode(!0),!0),dst:t.dst[n]})).map(e=>(!function(e){const t=[...e.src.querySelectorAll("script")].map(n.escape).reduce((e,t)=>()=>(e(),void t()),()=>void 0);r.replace(e.src,e.dst),t()}(e),[...e.src.querySelectorAll("img, iframe, frame")].map(u))).reduce(o.push,[])}).reduce(o.push,[])]},r.separate=function(e,t){return t.reduce((t,r)=>s.Maybe.mplus(t,function(e,t){return a(t).bind(t=>t.reduce((t,r)=>t.bind(t=>{const n={src:[...e.src.querySelectorAll(r)],dst:[...e.dst.querySelectorAll(r)]};return n.src.length>0&&n.src.length===n.dst.length?s.Just(o.push(t,[n])):s.Nothing}),s.Just([])))}(e,r).fmap(e=>[r,e])),s.Nothing)},r._split=a,r._wait=u},{"./script":119,"spica/array":5,"spica/maybe":24,"spica/promise":84,"typed-dom":94}],116:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.css=void 0;const n=e("./sync");r.css=function(e,t){const r='link[rel~="stylesheet"], style';return void["head","body"].map(t=>[e.src.querySelector(t),e.dst.querySelector(t)]).forEach(([e,t])=>void n.sync(n.pair(i(e),i(t),(e,t)=>e.outerHTML===t.outerHTML),t));function i(e){return[...e.querySelectorAll(r)].filter(e=>!t||!e.matches(t))}}},{"./sync":121}],117:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.focus=void 0;const n=e("../../../event/router");r.focus=function(e,t){switch(e){case n.RouterEventType.Click:case n.RouterEventType.Submit:return void[...t.querySelectorAll("[autofocus]")].slice(-1).filter(e=>e.closest("html")===window.document.documentElement&&e!==t.activeElement).forEach(e=>void e.focus());case n.RouterEventType.Popstate:return;default:throw new TypeError(e)}}},{"../../../event/router":107}],118:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.head=void 0;const n=e("./sync");r.head=function(e,t,r){return r+=t.includes("link")?', link[rel~="stylesheet"]':"",void n.sync(n.pair(i(e.src.head),i(e.dst.head),(e,t)=>e.outerHTML===t.outerHTML),e.dst.head);function i(e){return[...e.querySelectorAll(t)].filter(e=>!r||!e.matches(r))}}},{"./sync":121}],119:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.escape=r._evaluate=r._fetch=r.script=void 0;const o=e("spica/global"),c=e("../../../../../lib/error"),a=e("spica/promise"),u=e("spica/either"),l=e("spica/url"),h=e("spica/array"),d=e("spica/tuple"),p=e("spica/clock"),f=e("typed-dom");async function m(e,t){return e.hasAttribute("src")?"module"===e.type.toLowerCase()?u.Right([e,""]):a.AtomicPromise.race([window.fetch(e.src,{headers:new Headers({Accept:"application/javascript"}),integrity:e.integrity}),p.wait(t).then(()=>a.AtomicPromise.reject(new Error(`${e.src}: Timeout.`)))]).then(async t=>t.ok?u.Right([e,await t.text()]):e.matches("[src][async]")?y(e).then(()=>u.Right([e,""]),()=>u.Left(new Error(`${e.src}: ${t.statusText}`))):u.Left(new Error(t.statusText)),e=>u.Left(e)):u.Right([e,e.text])}function v(t,r,n,i,o,h){const d=!!(t=t.ownerDocument===document?t:document.importNode(t.cloneNode(!0),!0)).parentElement&&t.parentElement.matches(n.trim()||"_"),p=document.querySelector(d?t.parentElement.id?`#${t.parentElement.id}`:t.parentElement.tagName:"_")||document.body,f=b(t);p.appendChild(t),f(),!d&&t.remove();const m=a.AtomicPromise.resolve(o).then(function(){if(!h.alive)throw new c.FatalError("Expired.");if(t.matches('[type="module"][src]'))return a.AtomicPromise.resolve(Promise.resolve().then(()=>s(e(t.src)))).catch(e=>e.message.startsWith("Failed to load ")&&t.matches("[src][async]")?y(t).catch(()=>a.AtomicPromise.reject(e)):a.AtomicPromise.reject(e)).then(()=>(t.dispatchEvent(new Event("load")),u.Right(t)),e=>(t.dispatchEvent(new Event("error")),u.Left(new c.FatalError(e instanceof Error?e.message:e+""))));try{if(i.has(new l.URL(l.standardize(window.location.href)).href))throw new c.FatalError("Expired.");return(0,eval)(r),t.hasAttribute("src")&&t.dispatchEvent(new Event("load")),a.AtomicPromise.resolve(u.Right(t))}catch(e){return t.hasAttribute("src")&&t.dispatchEvent(new Event("error")),a.AtomicPromise.resolve(u.Left(new c.FatalError(e instanceof Error?e.message:e+"")))}});return t.matches("[src][async]")?u.Right(m):u.Left(m)}function b(e){const t=e.hasAttribute("src")?e.getAttribute("src"):null,r=e.text;return e.removeAttribute("src"),e.text="",()=>(e.text=" ",e.text=r,"string"==typeof t?void e.setAttribute("src",t):void 0)}function y(e){return new l.URL(l.standardize(e.src)).origin===new l.URL(l.standardize(window.location.href)).origin?a.AtomicPromise.reject(new Error):(e=f.html("script",Object.values(e.attributes).reduce((e,{name:t,value:r})=>(e[t]=r,e),{}),[...e.childNodes]),new a.AtomicPromise((t,r)=>(e.addEventListener("load",()=>void t(o.undefined)),e.addEventListener("error",r),document.body.appendChild(e),void e.remove())))}r.script=function(e,t,r,n,i,s={fetch:m,evaluate:v}){const o=[...e.src.querySelectorAll("script")].filter(e=>!e.type||/(?:application|text)\/(?:java|ecma)script|module/i.test(e.type)).filter(e=>!e.matches(r.ignore.trim()||"_")).filter(e=>!e.hasAttribute("src")||!t.has(new l.URL(l.standardize(e.src)).href)||e.matches(r.reload.trim()||"_")),{ss:c,as:p}=o.reduce((e,t)=>{switch(!0){case t.matches("[src][async], [src][defer]"):e.as.push(t);break;default:e.ss.push(t)}return e},{ss:[],as:[]});return a.AtomicPromise.all([a.AtomicPromise.all(f(c)).then(b),a.AtomicPromise.all(f(p)).then(b)]).then(async([e,t])=>e.fmap(async e=>(await e).fmap(([e,r])=>[e,r.then(async e=>t.fmap(async t=>(await t).fmap(([t,r])=>a.AtomicPromise.all([e,u.Right(t),r]).then(e=>e.reduce((e,t)=>e.bind(e=>t.fmap(t=>h.push(e,t)))))).extract(u.Left)).extract(u.Left))])).extract(u.Left));function f(e){return e.map(e=>s.fetch(e,n))}function b(e){return e.reduce((e,t)=>t.bind(()=>e),e.reduce((e,n)=>e.bind(i.either).bind(([e,o])=>n.fmap(([n,o])=>s.evaluate(n,o,r.logger,t,a.AtomicPromise.all(e),i)).bind(t=>t.extract(t=>u.Right(d.tuple(h.push(e,[t]),o)),t=>u.Right(d.tuple(e,h.push(o,[t])))))),u.Right([[],[]]))).fmap(([e,t])=>a.AtomicPromise.all(e).then(e=>u.Either.sequence(e)).then(e=>e.fmap(e=>d.tuple(e,Promise.all(t).then(e=>u.Either.sequence(e))))))}},r._fetch=m,r._evaluate=v,r.escape=b},{"../../../../../lib/error":138,"spica/array":5,"spica/clock":11,"spica/either":15,"spica/global":20,"spica/promise":84,"spica/tuple":90,"spica/url":92,"typed-dom":94}],120:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._hash=r.scroll=void 0;const n=e("../../../event/router");function i(e,t,r={scrollToElement:e=>void e.scrollIntoView()}){const n=t.slice(1);if(0===n.length)return!1;const i=e.getElementById(n)||e.getElementsByName(n)[0];return!!i&&(r.scrollToElement(i),!0)}r.scroll=function(e,t,r,s={scrollToElement:e=>void e.scrollIntoView(),scrollToPosition:({top:e,left:t})=>void window.scrollTo(t,e),hash:i}){switch(e){case n.RouterEventType.Click:if(s.hash(t,r.hash,s))return;return void s.scrollToPosition({top:0,left:0});case n.RouterEventType.Submit:return void s.scrollToPosition({top:0,left:0});case n.RouterEventType.Popstate:return void s.scrollToPosition(r.position());default:throw new TypeError(e)}},r._hash=i},{"../../../event/router":107}],121:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pair=r.sync=void 0;const n=e("spica/either"),i=e("spica/array");function s(e,t,r){t.map(t=>e.ownerDocument.importNode(t.cloneNode(!0),!0)).forEach(t=>void e.insertBefore(t,r))}function o(e){e.remove()}r.sync=function(e,t,r={before:s,remove:o}){return void e.forEach(([e,n])=>(r.before(function(e){return e?e.parentElement:t}(n),e.slice(-1).some(e=>!!n&&e.outerHTML===n.outerHTML)?e.slice(0,-1):e,n),n&&0===e.length?void r.remove(n):void 0))},r.pair=function(e,t,r){const s=function(e,t,r){return e.reduce((e,s)=>0===t.length?e.set(null,i.push(e.get(null)||[],[s])):t.reduce((e,t)=>e.bind(e=>!e.has(t)&&r(s,t)?(e.set(t,i.push(e.get(null)||[],[s])),e.delete(null),n.Left(e)):n.Right(e)),n.Right(e)).fmap(e=>e.set(null,i.push(e.get(null)||[],[s]))).extract(e=>e),new Map)}(e,t,r);return t.filter(e=>!s.has(e)).forEach(e=>void s.set(e,[])),[...s].map(([e,t])=>[t,e])}},{"spica/array":5,"spica/either":15}],122:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.title=void 0,r.title=function(e){e.dst.title=e.src.title}},{}],123:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._isReplaceable=r._isRegisterable=r.url=void 0;const n=e("../../../event/router");function i(e,t){if(t.dest.href===t.orig.href)return!1;switch(e){case n.RouterEventType.Click:case n.RouterEventType.Submit:return!0;case n.RouterEventType.Popstate:return!1;default:throw new TypeError(e)}}function s(e,t,r){switch(e){case n.RouterEventType.Click:case n.RouterEventType.Submit:return t.matches(r.trim()||"_");case n.RouterEventType.Popstate:return!1;default:throw new TypeError(e)}}e("typed-dom").bind(document,"pjax:ready",()=>void window.history.replaceState(window.history.state,window.document.title)),r.url=function(e,t,r,n,o){switch(!0){case s(r,n,o):return void window.history.replaceState({},t,e.dest.href);case i(r,e):return void window.history.pushState({},t,e.dest.href);default:return}},r._isRegisterable=i,r._isReplaceable=s},{"../../../event/router":107,"typed-dom":94}],124:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("../../data/store/state"),r)},{"../../data/store/state":104}],125:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClickView=void 0;const n=e("spica/coroutine"),i=e("typed-dom");r.ClickView=class extends n.Coroutine{constructor(e,t,r){super(async function*(){return this.finally(i.delegate(e,t,"click",e=>{(e.currentTarget instanceof HTMLAnchorElement||e.currentTarget instanceof HTMLAreaElement)&&r(e)}))},{delay:!1})}}},{"spica/coroutine":13,"typed-dom":94}],126:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NavigationView=void 0;const n=e("../../service/state/page"),i=e("../../../data/store/state"),s=e("spica/coroutine"),o=e("spica/url"),c=e("typed-dom");r.NavigationView=class extends s.Coroutine{constructor(e,t){super(async function*(){return this.finally(c.bind(e,"popstate",r=>{i.isTransitable(n.page.state)&&i.isTransitable(e.history.state)&&o.standardize(e.location.href)!==n.page.href&&t(r)}))},{delay:!1})}}},{"../../../data/store/state":104,"../../service/state/page":133,"spica/coroutine":13,"spica/url":92,"typed-dom":94}],127:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ScrollView=void 0;const n=e("../../service/state/page"),i=e("spica/coroutine"),s=e("spica/url"),o=e("spica/throttle"),c=e("typed-dom");r.ScrollView=class extends i.Coroutine{constructor(e,t){super(async function*(){return this.finally(c.bind(e,"scroll",o.debounce(100,r=>{s.standardize(e.location.href)===n.page.href&&t(r)}),{passive:!0}))},{delay:!1})}}},{"../../service/state/page":133,"spica/coroutine":13,"spica/throttle":89,"spica/url":92,"typed-dom":94}],128:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SubmitView=void 0;const n=e("spica/coroutine"),i=e("typed-dom");r.SubmitView=class extends n.Coroutine{constructor(e,t,r){super(async function*(){return this.finally(i.delegate(e,t,"submit",e=>{e.currentTarget instanceof HTMLFormElement&&r(e)}))},{delay:!1})}}},{"spica/coroutine":13,"typed-dom":94}],129:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.API=void 0;const n=e("./router"),i=e("./state/process"),s=e("../../data/store/state"),o=e("../../../lib/html"),c=e("spica/assign"),a=e("typed-dom");function u(e,t){const r=document.createElement("a");r.href=e,o.parse("").extract().body.appendChild(r),a.once(r,"click",t),a.once(r,"click",e=>void e.preventDefault()),r.click()}r.API=class{static assign(e,t,r={document:window.document,router:n.route}){let s;return u(e,e=>s=r.router(new n.Config(t),new n.RouterEvent(e),i.process,r)),s}static replace(e,t,r={document:window.document,router:n.route}){let s;return u(e,e=>s=r.router(new n.Config(c.extend({},t,{replace:"*"})),new n.RouterEvent(e),i.process,r)),s}static sync(e){e&&s.savePjax(),i.process.cast("",new Error("Canceled.")),n.sync()}static pushURL(e,t,r=null){window.history.pushState(r,t,e),this.sync()}static replaceURL(e,t,r=window.history.state){const n=s.isTransitable(window.history.state);window.history.replaceState(r,t,e),this.sync(n)}}},{"../../../lib/html":139,"../../data/store/state":104,"./router":131,"./state/process":134,"spica/assign":6,"typed-dom":94}],130:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GUI=void 0;const n=e("./api"),i=e("../module/view/click"),s=e("../module/view/submit"),o=e("../module/view/navigation"),c=e("../module/view/scroll"),a=e("./router");e("./state/scroll-restoration");const u=e("./state/process"),l=e("../../application/store"),h=e("spica/supervisor"),d=e("spica/copropagator");class p extends n.API{constructor(e,t={document:window.document,router:a.route}){super(),this.option=e,this.io=t,this.view=new f(this.option,this.io),p.resources.clear(),p.resources.register("view",this.view)}assign(e){return n.API.assign(e,this.option,this.io)}replace(e){return n.API.replace(e,this.option,this.io)}}r.GUI=p,p.resources=new class extends h.Supervisor{};class f extends d.Copropagator{constructor(e,t){const r=new a.Config(e),n=e=>void t.router(r,new a.RouterEvent(e),u.process,t);super([new i.ClickView(t.document,r.link,n),new s.SubmitView(t.document,r.form,n),new o.NavigationView(window,n),new c.ScrollView(window,l.savePosition)])}}},{"../../application/store":103,"../module/view/click":125,"../module/view/navigation":126,"../module/view/scroll":127,"../module/view/submit":128,"./api":129,"./router":131,"./state/process":134,"./state/scroll-restoration":136,"spica/copropagator":12,"spica/supervisor":88}],131:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._validate=r.sync=r.route=r.RouterEventSource=r.RouterEvent=r.Config=void 0;const n=e("../../application/router");Object.defineProperty(r,"Config",{enumerable:!0,get:function(){return n.Config}}),Object.defineProperty(r,"RouterEvent",{enumerable:!0,get:function(){return n.RouterEvent}}),Object.defineProperty(r,"RouterEventSource",{enumerable:!0,get:function(){return n.RouterEventSource}});const i=e("./state/page"),s=e("../service/state/env"),o=e("../../../lib/error"),c=e("../../application/store"),a=e("spica/url"),u=e("spica/cancellation"),l=e("spica/maybe"),h=e("spica/clock");function d(e,t,r){if(r.original.defaultPrevented)return!1;switch(r.type){case n.RouterEventType.Click:return o(e)&&(s=e,!(new a.URL(i.page.href).resource===s.resource&&""!==s.fragment))&&!p(e)&&!r.source.hasAttribute("download")&&!function(e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey}(r.original)&&t.filter(r.source);case n.RouterEventType.Submit:return o(e);case n.RouterEventType.Popstate:return o(e)&&!p(e);default:return!1}var s;function o(e){return new a.URL(i.page.href).origin===e.origin}}function p(e){const t=new a.URL(i.page.href);return t.resource===e.resource&&t.fragment!==e.fragment}e("typed-dom").bind(window,"pjax:unload",()=>window.history.scrollRestoration="auto",!0),r.route=function(e,t,r,f){switch(t.type){case n.RouterEventType.Click:case n.RouterEventType.Submit:c.savePosition();break;case n.RouterEventType.Popstate:f.document.title=c.loadTitle()}return l.Just(0).guard(d(t.request.url,e,t)).bind(()=>n.scope(e,(({orig:e,dest:t})=>({orig:e.pathname,dest:t.pathname}))(t.location))).fmap(async e=>{t.original.preventDefault(),r.cast("",new Error("Canceled."));const c=new u.Cancellation,l=r.register("",e=>(l(),c.cancel(e),h.never)),[d]=await s.env;return window.history.scrollRestoration="manual",n.route(e,t,{process:c,scripts:d},f).then(e=>e.fmap(async([e,t])=>(l(),i.page.sync(),e.filter(e=>e.hasAttribute("src")).forEach(e=>void d.add(new a.URL(a.standardize(e.src)).href)),void(await t).filter(e=>e.hasAttribute("src")).forEach(e=>void d.add(new a.URL(a.standardize(e.src)).href)))).extract()).catch(r=>(l(),i.page.sync(),window.history.scrollRestoration="auto",c.alive||r instanceof o.FatalError?void e.fallback(t.source,r):void 0))}).extract(()=>{switch(t.type){case n.RouterEventType.Click:return t.source.matches("[href]")&&r.cast("",new Error("Canceled.")),i.page.sync(),!1;case n.RouterEventType.Submit:return r.cast("",new Error("Canceled.")),i.page.sync(),!1;case n.RouterEventType.Popstate:return p(t.location.dest)?(r.cast("",new Error("Canceled.")),i.page.sync(),!1):(e.fallback(t.source,new Error("Disabled.")),i.page.sync(),!0)}},()=>!0)},r.sync=function(){i.page.sync()},r._validate=d},{"../../../lib/error":138,"../../application/router":102,"../../application/store":103,"../service/state/env":132,"./state/page":133,"spica/cancellation":8,"spica/clock":11,"spica/maybe":24,"spica/url":92,"typed-dom":94}],132:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.env=void 0;const n=e("./script");r.env=Promise.all([n.scripts,new Promise(e=>void setTimeout(e))])},{"./script":135}],133:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.page=void 0;const n=e("spica/global"),i=e("../../../data/store/state"),s=e("spica/url"),o=e("typed-dom");o.bind(n.window,"hashchange",()=>void r.page.sync()),o.bind(n.window,"popstate",()=>i.isTransitable(r.page.state)&&i.isTransitable(n.window.history.state)||void r.page.sync()),r.page=new class{constructor(){this.url=s.standardize(n.window.location.href),this.state_=n.window.history.state}get href(){return this.url}get state(){return this.state_}sync(){this.url=s.standardize(n.window.location.href),this.state_=n.window.history.state}}},{"../../../data/store/state":104,"spica/global":20,"spica/url":92,"typed-dom":94}],134:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.process=void 0;const n=e("spica/supervisor");r.process=new class extends n.Supervisor{}},{"spica/supervisor":88}],135:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scripts=void 0;const n=e("spica/url"),i=e("typed-dom");r.scripts=new Set,i.bind(window,"pjax:unload",()=>void document.querySelectorAll("script[src]").forEach(e=>void r.scripts.add(new n.URL(n.standardize(e.src)).href)))},{"spica/url":92,"typed-dom":94}],136:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),e("typed-dom").bind(window,"unload",()=>window.history.scrollRestoration="auto",!1)},{"typed-dom":94}],137:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.serialize=void 0,r.serialize=function(e){return[...e.elements].filter(e=>{if(!("name"in e))return!1;if(e.disabled)return!1;switch(e.tagName){case"INPUT":switch(e.type.toLowerCase()){case"checkbox":case"radio":return e.checked;case"submit":case"button":case"image":case"reset":case"file":return!1;default:return!0}case"SELECT":case"TEXTAREA":return!0;default:return!1}}).map(e=>[encodeURIComponent(t(e.name)),encodeURIComponent(t(e.value))].join("=")).join("&");function t(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,e=>2===e.length?e:"")}}},{}],138:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FatalError=void 0;class n extends Error{constructor(e){super(e)}}r.FatalError=n,Error.prototype.name="Error",n.prototype.name="FatalError"},{}],139:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._fixNoscript=r.fix=r.parse=void 0;const n=e("spica/maybe"),i=e("spica/either");function s(e){o(e).forEach(([e,t])=>e.textContent=t.textContent)}function o(e){return[...e.querySelectorAll("noscript")].filter(e=>e.children.length>0).map(e=>{const t=e.cloneNode(!0);return t.textContent=e.innerHTML,[e,t]})}r.parse=[function(e){const t=(new DOMParser).parseFromString(e,"text/html");return s(t),t},function(e){const t=window.document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),s(t),t}].reduce((e,t)=>e.bind(()=>!function(e){try{const t='\n<html lang="en" class="html">\n  <head>\n    <link href="/">\n    <title>&amp;</title>\n    <noscript><style>/**/</style></noscript>\n  </head>\n  <body>\n    <noscript>noscript</noscript>\n    <a href="/"></a>\n    <script>document.head.remove();<\/script>\n    <img src="abc">\n  </body>\n</html>\n',r=e(t);switch(!1){case"&"===r.title:case!!r.querySelector('html.html[lang="en"]'):case!!r.querySelector("head > link").href:case!!r.querySelector("body > a").href:case!r.querySelector("head > noscript > *"):case"document.head.remove();"===r.querySelector("script").innerHTML:case r.querySelector("img").src.endsWith("abc"):case"<style>/**/</style>"===r.querySelector("head > noscript").textContent:case"noscript"===r.querySelector("body > noscript").textContent:throw void 0}return!0}catch(e){return!1}}(t)?e:i.Left(t)),i.Right(()=>n.Nothing)).extract(e=>t=>n.Just(e(t))),r.fix=s,r._fixNoscript=o},{"spica/either":15,"spica/maybe":24}],140:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._match=r._expand=r.compare=r.router=void 0;const n=e("spica/url"),i=e("spica/sequence"),s=e("spica/curry"),o=e("spica/flip"),c=e("spica/memoize");function a(e,t){const r=/\/|[^/]+\/?/g,n=/\/$/;return i.Sequence.zip(i.Sequence.from(u(e)),i.Sequence.cycle([t])).map(([e,t])=>[e.match(r)||[],e.match(n)?t.match(r)||[]:t.replace(n,"").match(r)||[]]).filter(([e,t])=>e.length<=t.length&&0===i.Sequence.zip(i.Sequence.from(e),i.Sequence.from(t)).dropWhile(([e,t])=>l(e,t)).take(1).extract().length).take(1).extract().length>0}r.router=function(e){return t=>{const{path:r,pathname:c}=new n.URL(n.standardize(t,window.location.href));return i.Sequence.from(Object.keys(e).filter(e=>"/"===e[0]).sort().reverse()).filter(s.curry(o.flip(a))(c)).map(t=>e[t]).take(1).extract().pop().call(e,r)}},r.compare=a;const u=c.memoize(e=>{if(e.match(/\*\*|[\[\]]/))throw new Error(`Invalid pattern: ${e}`);return""===e?[e]:i.Sequence.from(e.match(/{[^{}]*}|.[^{]*/g)).map(e=>e.match(/^{[^{}]*}$/)?e.slice(1,-1).split(","):[e]).mapM(i.Sequence.from).map(e=>e.join("")).bind(t=>t===e?i.Sequence.from([t]):i.Sequence.from(u(t))).unique().extract()});r._expand=u;const l=c.memoize((e,t)=>{return("."!==t[0]||![..."?*"].includes(e[0]))&&function e(t,r){const[n="",...s]=[...t];const[o="",...c]=[...r];switch(n){case"":return""===o;case"?":return""!==o&&"/"!==o&&e(s.join(""),c.join(""));case"*":return"/"===o?e(s.join(""),r):i.Sequence.zip(i.Sequence.cycle([s.join("")]),i.Sequence.from(r).tails().map(e=>e.join(""))).filter(([t,r])=>e(t,r)).take(1).extract().length>0;default:return o===n&&e(s.join(""),c.join(""))}}(function e(t){const r=t.replace(/\*(\?+)\*?/g,"$1*");return r===t?r:e(r)}(e),t)},(e,t)=>`${e} ${t}`);r._match=l},{"spica/curry":14,"spica/flip":17,"spica/memoize":25,"spica/sequence":86,"spica/url":92}],"pjax-api":[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=e("./src/export");Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s(o).default}}),i(e("./src/export"),r)},{"./src/export":101}]},{},[1,2,3,"pjax-api"]),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports&&(module.exports=t())}("undefined"!=typeof self&&self,function(){return require("pjax-api")});